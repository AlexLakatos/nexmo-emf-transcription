(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7db3"],{"01d3":function(e,t,r){(function(t){var n=r("c9eb");e.exports=function(e){var r=e.xdomain,i=e.xscheme,o=e.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!r||n))return new XMLHttpRequest}catch(e){}try{if("undefined"!==typeof XDomainRequest&&!i&&o)return new XDomainRequest}catch(e){}if(!r)try{return new(t[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(this,r("c8ba"))},"0299":function(e,t,r){"use strict";var n,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),o=64,s={},a=0,c=0;function d(e){var t="";do{t=i[e%o]+t,e=Math.floor(e/o)}while(e>0);return t}function p(e){var t=0;for(c=0;c<e.length;c++)t=t*o+s[e.charAt(c)];return t}function u(){var e=d(+new Date);return e!==n?(a=0,n=e):e+"."+d(a++)}for(;c<o;c++)s[i[c]]=c;u.encode=d,u.decode=p,e.exports=u},"0464":function(e,t){const r={"error:application:call:params":{type:"error:application:call:params",description:"not a valid String[] of usernames param"},"error:application:callPhone:params":{type:"error:application:call:params",description:"not a valid String of phone number"},"error:call:reject":{type:"error:call:reject",description:"failed to reject the call"},"error:getUserMedia:permissions":{type:"error:getUserMedia:permissions",description:"missing getUserMedia permissions"},"error:media:params":{type:"error:media:params",description:"currently supported params media type= {audio:{muted:false, earmuffed:false}}"},"error:self":{type:"error:self",description:"Conversation Object is missing self (me)"},"error:user:relogin":{type:"error:user:relogin",description:"please relogin"},"error:seen:own-message":{type:"error:seen:own-message",description:"attempt to send seen for own message"},"error:already-seen":{type:"error:already-seen",description:"already marked as seen"},"error:delivered:own-message":{type:"error:delivered:own-message",description:"attempt to send delivered for own message"},"error:already-delivered":{type:"error:already-delivered",description:"already marked as delivered"},"error:fetch-image":{type:"error:fetch-image",description:"xhr.status received other than 200"},"error:missing:params":{type:"error:missing:params",description:"missing parameters"},"error:invite:missing:params":{type:"error:missing:params",description:"This invite cannot be sent to empty username and user_id"},"error:invalid:param:type":{type:"error:invalid:param:type",description:"Invalid Object type, passed in the parameters"},"error:audio:already-connecting":{type:"error:audio:already-connecting",description:"Audio call already in progress"},"error:audio:not-enabled":{type:"error:audio:not-enabled",description:"Audio is not enabled"},"error:media:already-connecting":{type:"error:media:already-connecting",description:"Media is already in progress"},"error:media:not-enabled":{type:"error:media:not-enabled",description:"Media is not enabled"},"error:media:unsupported-browser":{type:"error:media:unsupported-browser",description:"This action is not supported on this browser"},"error:media:extension":{type:"error:media:extension",description:"Chrome extension has thrown an error"},"error:media:extension-not-installed":{type:"error:media:extension-not-installed",description:"Chrome extension should be installed"},"error:media:update:streams":{type:"error:media:update:streams",description:"cant update more than one stream"},"error:media:update:unsupported":{type:"error:media:update:unsupported",description:"params are not valid for update - need video or screenshare"},"error:media:update:invalid":{type:"error:media:update:invalid",description:"state of media is not supported for this update"},"error:media:stream:not-found":{type:"error:media:stream:not-found",description:"A stream with the given index was not found"}};e.exports=r},"0882":function(e,t,r){(function(t){var n,i=r("19b7"),o=r("5a6e"),s=r("4f2a"),a=r("62fa"),c=r("0299"),d=r("34eb")("engine.io-client:websocket"),p=t.WebSocket||t.MozWebSocket;if("undefined"===typeof window)try{n=r(4)}catch(e){}var u=p;function h(e){var t=e&&e.forceBase64;t&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=p&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(u=n),i.call(this,e)}u||"undefined"!==typeof window||(u=n),e.exports=h,a(h,i),h.prototype.name="websocket",h.prototype.supportsBinary=!0,h.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new u(e,t):new u(e):new u(e,t,r)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},h.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},h.prototype.write=function(e){var r=this;this.writable=!1;for(var n=e.length,i=0,s=n;i<s;i++)(function(e){o.encodePacket(e,r.supportsBinary,function(i){if(!r.usingBrowserWebSocket){var o={};if(e.options&&(o.compress=e.options.compress),r.perMessageDeflate){var s="string"===typeof i?t.Buffer.byteLength(i):i.length;s<r.perMessageDeflate.threshold&&(o.compress=!1)}}try{r.usingBrowserWebSocket?r.ws.send(i):r.ws.send(i,o)}catch(e){d("websocket closed before onclose event")}--n||a()})})(e[i]);function a(){r.emit("flush"),setTimeout(function(){r.writable=!0,r.emit("drain")},0)}},h.prototype.onClose=function(){i.prototype.onClose.call(this)},h.prototype.doClose=function(){"undefined"!==typeof this.ws&&this.ws.close()},h.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||(e.b64=1),e=s.encode(e),e.length&&(e="?"+e);var n=-1!==this.hostname.indexOf(":");return t+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+e},h.prototype.check=function(){return!!u&&!("__initialize"in u&&this.name===h.prototype.name)}}).call(this,r("c8ba"))},"0949":function(e,t,r){var n=r("19b7"),i=r("4f2a"),o=r("5a6e"),s=r("62fa"),a=r("0299"),c=r("34eb")("engine.io-client:polling");e.exports=p;var d=function(){var e=r("01d3"),t=new e({xdomain:!1});return null!=t.responseType}();function p(e){var t=e&&e.forceBase64;d&&!t||(this.supportsBinary=!1),n.call(this,e)}s(p,n),p.prototype.name="polling",p.prototype.doOpen=function(){this.poll()},p.prototype.pause=function(e){var t=this;function r(){c("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(c("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){c("pre-pause polling complete"),--n||r()})),this.writable||(c("we are currently writing - waiting to pause"),n++,this.once("drain",function(){c("pre-pause writing complete"),--n||r()}))}else r()},p.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},p.prototype.onData=function(e){var t=this;c("polling got data %s",e);var r=function(e,r,n){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)};o.decodePayload(e,this.socket.binaryType,r),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},p.prototype.doClose=function(){var e=this;function t(){c("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},p.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};o.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,r)})},p.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";!1!==this.timestampRequests&&(e[this.timestampParam]=a()),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(r=":"+this.port),e.length&&(e="?"+e);var n=-1!==this.hostname.indexOf(":");return t+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+e}},"0a5e":function(e,t,r){(function(t){var n=r("0949"),i=r("62fa");e.exports=d;var o,s=/\n/g,a=/\\n/g;function c(){}function d(e){n.call(this,e),this.query=this.query||{},o||(t.___eio||(t.___eio=[]),o=t.___eio),this.index=o.length;var r=this;o.push(function(e){r.onData(e)}),this.query.j=this.index,t.document&&t.addEventListener&&t.addEventListener("beforeunload",function(){r.script&&(r.script.onerror=c)},!1)}i(d,n),d.prototype.supportsBinary=!1,d.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},d.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t;var n="undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent);n&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},d.prototype.doWrite=function(e,t){var r=this;if(!this.form){var n,i=document.createElement("form"),o=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=c,i.method="POST",i.setAttribute("accept-charset","utf-8"),o.name="d",i.appendChild(o),document.body.appendChild(i),this.form=i,this.area=o}function d(){p(),t()}function p(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(e)}catch(e){n=document.createElement("iframe"),n.name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),p(),e=e.replace(a,"\\\n"),this.area.value=e.replace(s,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&d()}:this.iframe.onload=d}}).call(this,r("c8ba"))},"0b64":function(e,t){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}},"11c1":function(e,t,r){var n=r("c437"),i=r("c64e"),o=i;o.v1=n,o.v4=i,e.exports=o},1468:function(e,t){var r=1e3,n=60*r,i=60*n,o=24*i,s=365.25*o;function a(e){if(e=String(e),!(e.length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var a=parseFloat(t[1]),c=(t[2]||"ms").toLowerCase();switch(c){case"years":case"year":case"yrs":case"yr":case"y":return a*s;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}function c(e){return e>=o?Math.round(e/o)+"d":e>=i?Math.round(e/i)+"h":e>=n?Math.round(e/n)+"m":e>=r?Math.round(e/r)+"s":e+"ms"}function d(e){return p(e,o,"day")||p(e,i,"hour")||p(e,n,"minute")||p(e,r,"second")||e+" ms"}function p(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}e.exports=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return a(e);if("number"===r&&!1===isNaN(e))return t.long?d(e):c(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},1808:function(e,t,r){"use strict";var n=r("955b");e.exports=function(e,t){var i=e&&e.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);var a=n.log,c=n.detectBrowser(i),d=r("fa98")||null,p=r("b093")||null,u=r("32ea")||null,h=r("8283")||null,l=r("8204")||null,f={browserDetails:c,commonShim:l,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(c.browser){case"chrome":if(!d||!d.shimPeerConnection||!o.shimChrome)return a("Chrome shim is not included in this adapter release."),f;a("adapter.js shimming chrome."),f.browserShim=d,l.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimMediaStream(i),d.shimSourceObject(i),d.shimPeerConnection(i),d.shimOnTrack(i),d.shimAddTrackRemoveTrack(i),d.shimGetSendersWithDtmf(i),d.shimSenderReceiverGetStats(i),d.fixNegotiationNeeded(i),l.shimRTCIceCandidate(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;case"firefox":if(!u||!u.shimPeerConnection||!o.shimFirefox)return a("Firefox shim is not included in this adapter release."),f;a("adapter.js shimming firefox."),f.browserShim=u,l.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimSourceObject(i),u.shimPeerConnection(i),u.shimOnTrack(i),u.shimRemoveStream(i),u.shimSenderGetStats(i),u.shimReceiverGetStats(i),u.shimRTCDataChannel(i),l.shimRTCIceCandidate(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;case"edge":if(!p||!p.shimPeerConnection||!o.shimEdge)return a("MS edge shim is not included in this adapter release."),f;a("adapter.js shimming edge."),f.browserShim=p,l.shimCreateObjectURL(i),p.shimGetUserMedia(i),p.shimPeerConnection(i),p.shimReplaceTrack(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;case"safari":if(!h||!o.shimSafari)return a("Safari shim is not included in this adapter release."),f;a("adapter.js shimming safari."),f.browserShim=h,l.shimCreateObjectURL(i),h.shimRTCIceServerUrls(i),h.shimCreateOfferLegacy(i),h.shimCallbacksAPI(i),h.shimLocalStreamsAPI(i),h.shimRemoteStreamsAPI(i),h.shimTrackEventTransceiver(i),h.shimGetUserMedia(i),l.shimRTCIceCandidate(i),l.shimMaxMessageSize(i),l.shimSendThrowTypeError(i);break;default:a("Unsupported browser!");break}return f}},"19b7":function(e,t,r){var n=r("5a6e"),i=r("7297");function o(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}e.exports=o,i(o.prototype),o.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},o.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(e){var t=n.decodePacket(e,this.socket.binaryType);this.onPacket(t)},o.prototype.onPacket=function(e){this.emit("packet",e)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},"1fb5":function(e,t,r){"use strict";t.byteLength=p,t.toByteArray=h,t.fromByteArray=m;for(var n=[],i=[],o="undefined"!==typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function d(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function p(e){var t=d(e),r=t[0],n=t[1];return 3*(r+n)/4-n}function u(e,t,r){return 3*(t+r)/4-r}function h(e){for(var t,r=d(e),n=r[0],s=r[1],a=new o(u(e,n,s)),c=0,p=s>0?n-4:n,h=0;h<p;h+=4)t=i[e.charCodeAt(h)]<<18|i[e.charCodeAt(h+1)]<<12|i[e.charCodeAt(h+2)]<<6|i[e.charCodeAt(h+3)],a[c++]=t>>16&255,a[c++]=t>>8&255,a[c++]=255&t;return 2===s&&(t=i[e.charCodeAt(h)]<<2|i[e.charCodeAt(h+1)]>>4,a[c++]=255&t),1===s&&(t=i[e.charCodeAt(h)]<<10|i[e.charCodeAt(h+1)]<<4|i[e.charCodeAt(h+2)]>>2,a[c++]=t>>8&255,a[c++]=255&t),a}function l(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function f(e,t,r){for(var n,i=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(l(n));return i.join("")}function m(e){for(var t,r=e.length,i=r%3,o=[],s=16383,a=0,c=r-i;a<c;a+=s)o.push(f(e,a,a+s>c?c:a+s));return 1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},2334:function(e,t,r){const n=r("a4c8"),i=r("9fca"),o=r("60f1"),s=r("5c7d");class a{constructor(e){this.log=s.getLogger(this.constructor.name),this.application=e,this._handleApplicationEventMap={"member:joined":this._processMemberJoined,"member:invited":this._processMemberInvited}}handleEvent(e){const t=this.application.conversations[e.cid],r=Object.assign({},e);return this._handleApplicationEventMap.hasOwnProperty(e.type)&&this._handleApplicationEventMap[e.type].call(this,t,new n(t,r))||new n(t,r)}_processMemberJoined(e,t){if(t.body.channel&&t.body.channel.knocking_id&&this.application._call_draft_list.has(t.body.channel.knocking_id)){const r=this.application._call_draft_list.get(t.body.channel.knocking_id);r._setupConversationObject(e),r._setFrom(e.me),this.application._call_draft_list.delete(t.body.channel.knocking_id),delete r.knocking_id,this.application.calls.set(e.id,r),r._handleStatusChange(t),this.application.emit("member:call",this.application.conversations[t.cid].members[t.from],r)}return t}_processMemberInvited(e,t){if(e.me&&e.me.user.name===t.body.invited_by||!t.body.user.media||!t.body.user.media.audio)return t;if(e.display_name&&e.display_name.startsWith("CALL_")){const r=o.getMemberFromNameOrNull(e,t.body.invited_by)||"unknown",n=new i(this.application,e,r);this.application.calls.set(e.id,n),this.application.emit("member:call",this.application.conversations[t.cid].members[t.from],n)}else if(!t.body.invited_by){const r=new i(this.application,e,"unknown");this.application.calls.set(e.id,r),r._handleStatusChange(t),this.application.emit("member:call",this.application.conversations[t.cid].members[t.from],r)}return t}}e.exports=a},2366:function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);function i(e,t){var n=t||0,i=r;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")}e.exports=i},"239e":function(e,t,r){const n=r("4380"),i=r("5c7d");class o{constructor(e){this.log=i.getLogger("Cache"),this.rtc=e;const t=new n;this.worker=null,this.events_from_idb=new Map;let r=null;"undefined"!==typeof Storage?(r=localStorage.getItem("NXMO_user_data"),r&&(this.user_data=JSON.parse(r)),this.log.info("auto-relogin is enabled")):this.log.info("auto-relogin could not be enabled"),"undefined"!==typeof window&&window.Worker?(this.log.info("initialising cache with webWorker"),this.worker=new Worker(URL.createObjectURL(t.cache_worker_blob)),this.attachWorkerListener(),this.conversations_idb_count=0):this.log.warn("webWorker is not supported")}init(e){this.worker&&(e.connection.io.on("packet",t=>{if(!e.cache||2!==t.type||"echo"===t.data[0])return;const r=t.data[1];r.type=t.data[0],this.log.trace("[<--]",r.type,r),this.process_response(r)}),e.connection.io.on("reconnect",()=>{this.user_data&&e.login(e.cache.user_data.token)}),this._sendRequest=e.sendRequest,e.sendRequest=((e,t)=>{this.process_request(e).then(r=>{return r?t(r):this._sendRequest.call(this.rtc,e,t)})}),this.log.info("cache initialised"))}attachWorkerListener(){this.worker.onmessage=(e=>{switch(this.log.debug("[<--] (WebWorker): ",e.type,e.data.worker_action),e.data.worker_action){case"conversations:idb:count":this.conversations_idb_count=e.data.conversations_idb_count,this.log.debug(`[<--] (WebWorker): number of conversations: ${this.conversations_idb_count}`);break;case"events:storage:get":this.events_from_idb.set(e.data.cid,e.data);break}delete e.data.worker_action})}process_response(e){let t=!1;if(this.worker){switch(e.type){case"conversation:events:success":e.cid=this.rtc.requests[e.rid].request.cid,e.worker_action="events:storage:update";break;case"conversation:get:success":e.worker_action="conversations:storage:add";break;case"image":case"text":e.worker_action="events:storage:add",this.events_from_idb.set(e.cid,e);break;case"event:delete":e.worker_action="events:storage:delete",this.events_from_idb.delete(e.cid,e);break;case"conversation:delete:success":e.cid=this.rtc.requests[e.rid].request.cid;case"conversation:delete":e.worker_action="conversation:storage:delete",this.events_from_idb.delete(e.cid,e);break;case"session:logged-out":case"session:terminated":t=!0,this.invalidate();default:t=!0,this.log.debug(`[--] ignoring response: ${e.type}`);break}t||(this.worker.postMessage(e),this.log.debug(`[--\x3e] (WebWorker): ${e.type}`,e))}}process_request(e){switch(e.type){case"conversation:events":if(this.events_from_idb.has(e.cid)&&this.events_from_idb.get(e.cid).events)return Promise.resolve(this.events_from_idb.get(e.cid).events);{const t={worker_action:"events:storage:get",cid:e.cid};this.worker.postMessage(t),this.log.debug("[--\x3e] (WebWorker): ",e.type,t)}break}return Promise.resolve()}updateToken(e){"undefined"!==typeof Storage&&localStorage.setItem("NXMO_user_data",JSON.stringify(e))}invalidate(){if(!this.worker)return;const e={worker_action:"conversations:invalidate"};this.worker.postMessage(e),"undefined"!==typeof Storage&&localStorage.removeItem("NXMO_user_data"),this.log.debug("[--\x3e] (WebWorker): ",e.worker_action)}}e.exports=o},"282b":function(e,t,r){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var r={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1];break}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)t=n[i].trim().split("="),r[t[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){var r=n.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:r.map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},n.getIceParameters=function(e,t){var r=n.splitLines(e);r=r.concat(n.splitLines(t));var i={usernameFragment:r.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return i},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e),i=r[0].split(" "),o=3;o<i.length;o++){var s=i[o],a=n.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(a){var c=n.parseRtpMap(a),d=n.matchPrefix(e,"a=fmtp:"+s+" ");switch(c.parameters=d.length?n.parseFmtp(d[0]):{},c.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(n.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase());break;default:break}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=a.length>0&&a[0].ssrc,d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.substr(17).split(" ");return t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),r.push(n),o&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:t,mechanism:s?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var p=n.matchPrefix(e,"b=");return p.length&&(p=0===p[0].indexOf("b=TIAS:")?parseInt(p[0].substr(7),10):0===p[0].indexOf("b=AS:")?1e3*parseInt(p[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=p})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=n.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return t=r[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t){var r,i=void 0!==t?t:2;return r=e||n.generateSessionId(),"v=0\r\no=thisisadapterortc "+r+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2);default:}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){var t=n.splitLines(e),r=t[0].split(" ");return r[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e),r=t[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0],r=t.substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},n.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;for(var t=n.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},e.exports=n},2851:function(e,t,r){var n=r("568d"),i=r("7297"),o=r("9121"),s=r("d838"),a=r("40de"),c=r("34eb")("socket.io-client:socket"),d=r("4f2a"),p=r("58b1");e.exports=l;var u={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},h=i.prototype.emit;function l(e,t,r){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}i(l.prototype),l.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",a(this,"onopen")),s(e,"packet",a(this,"onpacket")),s(e,"close",a(this,"onclose"))]}},l.prototype.open=l.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},l.prototype.send=function(){var e=o(arguments);return e.unshift("message"),this.emit.apply(this,e),this},l.prototype.emit=function(e){if(u.hasOwnProperty(e))return h.apply(this,arguments),this;var t=o(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:p(t))?n.BINARY_EVENT:n.EVENT,data:t,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"===typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},l.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},l.prototype.onopen=function(){if(c("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"===typeof this.query?d.encode(this.query):this.query;c("sending connect packet with query %s",e),this.packet({type:n.CONNECT,query:e})}else this.packet({type:n.CONNECT})},l.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},l.prototype.onpacket=function(e){var t=e.nsp===this.nsp,r=e.type===n.ERROR&&"/"===e.nsp;if(t||r)switch(e.type){case n.CONNECT:this.onconnect();break;case n.EVENT:this.onevent(e);break;case n.BINARY_EVENT:this.onevent(e);break;case n.ACK:this.onack(e);break;case n.BINARY_ACK:this.onack(e);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",e.data);break}},l.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?h.apply(this,t):this.receiveBuffer.push(t)},l.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var i=o(arguments);c("sending ack %j",i),t.packet({type:p(i)?n.BINARY_ACK:n.ACK,id:e,data:i})}}},l.prototype.onack=function(e){var t=this.acks[e.id];"function"===typeof t?(c("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):c("bad ack %s",e.id)},l.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},l.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)h.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},l.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},l.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},l.prototype.close=l.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},l.prototype.compress=function(e){return this.flags.compress=e,this},l.prototype.binary=function(e){return this.flags.binary=e,this}},"29d2":function(e,t){class r{constructor(e,t,n,i){var o=0,s=!!window.mozRTCPeerConnection,a=!!window.RTCIceGatherer,c=this;if(i.forEach(function(i){if(window[i+"RTCPeerConnection"]&&("webkit"!==i||!a)){var d=window[i+"RTCPeerConnection"],p=function(i,p){var u="PC_"+o++,h=new d(i,p);e("clientId",u,p.optional[p.optional.length-1].clientId),i||(i={nullConfig:!0}),i=JSON.parse(JSON.stringify(i)),(i&&i.iceServers||[]).forEach(function(e){delete e.credential}),i.browserType=s?"moz":a?"edge":"webkit",e("create",u,i),p&&e("constraints",u,p),h.trace=function(t,r){t&&r&&e(t,u,r)},["createDataChannel","close","addTrack","removeTrack"].forEach(function(t){if(d.prototype[t]){var r=h[t];h[t]=function(){return e(t,u,arguments),r.apply(h,arguments)}}}),["addStream","removeStream"].forEach(function(t){if(d.prototype[t]){var r=h[t];h[t]=function(n){var i=n.getTracks().map(function(e){return e.kind+":"+e.id});return e(t,u,n.id+" "+i),r.call(h,n)}}}),["createOffer","createAnswer"].forEach(function(t){if(d.prototype[t]){var r=h[t];h[t]=function(){var n,i=arguments;return 1===arguments.length&&"object"===typeof arguments[0]?n=arguments[0]:3===arguments.length&&"object"===typeof arguments[2]&&(n=arguments[2]),e(t,u,n),new Promise(function(n,o){r.apply(h,[function(r){e(t+"OnSuccess",u,r),n(r),i.length>0&&"function"===typeof i[0]&&i[0].apply(null,[r])},function(r){e(t+"OnFailure",u,r.toString()),o(r),i.length>1&&"function"===typeof i[1]&&i[1].apply(null,[r])}])})}}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){if(d.prototype[t]){var r=h[t];h[t]=function(){var n=arguments;return e(t,u,n[0]),new Promise(function(i,o){r.apply(h,[n[0],function(){e(t+"OnSuccess",u),i(),n.length>=2&&n[1].apply(null,[])},function(r){e(t+"OnFailure",u,r.toString()),o(r),n.length>=3&&n[2].apply(null,[r])}])})}}}),h.addEventListener("icecandidate",function(t){e("onicecandidate",u,t.candidate)}),h.addEventListener("addstream",function(t){e("onaddstream",u,t.stream.id+" "+t.stream.getTracks().map(function(e){return e.kind+":"+e.id}))}),h.addEventListener("removestream",function(t){e("onremovestream",u,t.stream.id+" "+t.stream.getTracks().map(function(e){return e.kind+":"+e.id}))}),h.addEventListener("signalingstatechange",function(){e("onsignalingstatechange",u,h.signalingState)}),h.addEventListener("iceconnectionstatechange",function(){e("oniceconnectionstatechange",u,h.iceConnectionState)}),h.addEventListener("icegatheringstatechange",function(){e("onicegatheringstatechange",u,h.iceGatheringState)}),h.addEventListener("negotiationneeded",function(){e("onnegotiationneeded",u)}),h.addEventListener("datachannel",function(t){e("ondatachannel",u,[t.channel.id,t.channel.label])});var l={};return c.stats_interval=window.setInterval(()=>{"closed"!==h.signalingState?h.getStats(null).then(n=>{if(t){let t=r.getMos(n);e("mos",t,n)}else{var i=r.map2obj(n),o=JSON.parse(JSON.stringify(i));e("getstats",u,r.deltaCompression(l,i)),l=o}}):window.clearInterval(c.stats_interval)},n),h};d.generateCertificate&&Object.defineProperty(p,"generateCertificate",{get:function(){return arguments.length?d.generateCertificate.apply(null,arguments):d.generateCertificate}}),window[i+"RTCPeerConnection"]=p,window[i+"RTCPeerConnection"].prototype=d.prototype}}),i.forEach(function(t){var n=t+(t.length?"GetUserMedia":"getUserMedia");if(navigator[n]){var i=navigator[n].bind(navigator),o=function(){e("getUserMedia",null,arguments[0]);var t=arguments[1],n=arguments[2];i(arguments[0],function(n){e("getUserMediaOnSuccess",null,r.dumpStream(n)),t&&t(n)},function(t){e("getUserMediaOnFailure",null,t.name),n&&n(t)})};navigator[n]=o.bind(navigator)}}),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var d=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices),p=function(){return e("navigator.mediaDevices.getUserMedia",null,arguments[0]),d.apply(navigator.mediaDevices,arguments).then(function(t){return e("navigator.mediaDevices.getUserMediaOnSuccess",null,r.dumpStream(t)),t},function(t){return e("navigator.mediaDevices.getUserMediaOnFailure",null,t.name),Promise.reject(t)})};navigator.mediaDevices.getUserMedia=p.bind(navigator.mediaDevices)}}static map2obj(e){if(!e.entries)return e;var t={};return e.forEach(function(e,r){t[r]=e}),t}static deltaCompression(e,t){return t=JSON.parse(JSON.stringify(t)),Object.keys(t).forEach(function(r){if(e[r]){var n=t[r];Object.keys(n).forEach(function(i){n[i]===e[r][i]&&delete t[r][i],delete n.timestamp,0===Object.keys(n).length&&delete t[r]})}}),t.timestamp=new Date,t}static dumpStream(e){return{id:e.id,tracks:e.getTracks().map(function(e){return{id:e.id,kind:e.kind,label:e.label,enabled:e.enabled,muted:e.muted,readyState:e.readyState}})}}disable(){if(!this.stats_interval)throw new Error("rtc stats not enabled");window.clearInterval(this.stats_interval)}static getMos(e){let t=0,r=0,n=0,i=100,o=0,s=0,a=0,c=0;for(let d of e.values())"inbound-rtp"===d.type&&(t=d.jitter,n=d.packetsLost,r=d.packetsReceived);return r+n>0&&(o=n/(r+n)*100),s=i+2*t+10,a=s<160?93.2-s/40:93.2-(s-120)/10,a-=2.5*o,a<1&&(a=1),c=1+.035*a+7e-6*a*(a-60)*(100-a),parseFloat(c).toFixed(6)}}e.exports=r},"32ea":function(e,t,r){"use strict";var n=r("955b");e.exports={shimGetUserMedia:r("a578"),shimOnTrack:function(e){"object"!==typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var r=new Event("track");r.track=t,r.receiver={track:t},r.transceiver={receiver:r.receiver},r.streams=[e.stream],this.dispatchEvent(r)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"===typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=n.detectBrowser(e);if("object"===typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(r,n){if(t.version<38&&r&&r.iceServers){for(var i=[],o=0;o<r.iceServers.length;o++){var s=r.iceServers[o];if(s.hasOwnProperty("urls"))for(var a=0;a<s.urls.length;a++){var c={url:s.urls[a]};0===s.urls[a].indexOf("turn")&&(c.username=s.username,c.credential=s.credential),i.push(c)}else i.push(r.iceServers[o])}r.iceServers=i}return new e.mozRTCPeerConnection(r,n)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i=function(e){var t=new Map;return Object.keys(e).forEach(function(r){t.set(r,e[r]),t[r]=e[r]}),t},o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,n){return s.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=i(e)),t.version<53&&!r)try{e.forEach(function(e){e.type=o[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:o[t.type]||t.type}))})}return e}).then(r,n)}}},shimSenderGetStats:function(e){if("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&-1!==e.getTracks().indexOf(r.track)&&t.removeTrack(r)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},shimGetDisplayMedia:function(e,t){"getDisplayMedia"in e.navigator||(navigator.getDisplayMedia=function(e){if(!e||!e.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===e.video?e.video={mediaSource:t}:e.video.mediaSource=t,navigator.mediaDevices.getUserMedia(e)})}}},3396:function(e,t,r){const n=r("0464");function i(e,t){Object.assign(e,t),e.message="type: "+e.type+", description: "+(e.description?e.description:""),e.stack=(new Error).stack}const o=function(e){const t=n[e];t?i(this,t):(this.message=e&&e.message?e.message:e,this.stack=e&&e.stack?e.stack:(new Error).stack),this.name="NexmoClientError"};o.prototype=Object.create(o.prototype),o.prototype.constructor=o;const s=function(e){i(this,e),this.name="NexmoApiError"};s.prototype=Object.create(s.prototype),s.prototype.constructor=s,e.exports={NexmoClientError:o,NexmoApiError:s}},"34eb":function(e,t,r){(function(n){function i(){return!("undefined"===typeof window||!window.process||"renderer"!==window.process.type)||("undefined"===typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),r){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,n)}}function s(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}}function c(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!==typeof n&&"env"in n&&(e=Object({NODE_ENV:"production",BASE_URL:"/"}).DEBUG),e}function d(){try{return window.localStorage}catch(e){}}t=e.exports=r("96fe"),t.log=s,t.formatArgs=o,t.save=a,t.load=c,t.useColors=i,t.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:d(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(c())}).call(this,r("4362"))},"38c5":function(e,t,r){const n=r("a7b3"),i=r("5c7d"),o=r("66ff"),s=r("a4c8"),a=r("6668"),c=r("5113"),d=r("8a6d"),p=r("b570"),u=r("3396"),h=r("60f1"),l=u.NexmoApiError,f=u.NexmoClientError;class m{constructor(e,t){this.log=i.getLogger(this.constructor.name),this.application=e,this.id=null,this.name=null,this.display_name=null,this.timestamp=null,this.members={},this.events=new Map,this.sequence_number=0,this.is_video_conversation=!1,this.conversationEventHandler=new p(e,this),this.media=new d(this),this.me=null,this._updateObjectInstance(t),n.mixin(m)}_updateObjectInstance(e){for(let t in e)switch(t){case"id":this.id=e.id;break;case"name":this.name=e.name;break;case"display_name":this.display_name=e.display_name;break;case"members":e.members.map(e=>{if(this.members[e.member_id])this.members[e.member_id]._normalise(e),e.user_id===this.application.me.id&&"LEFT"!==e.state&&(this.me=this.members[e.member_id]);else{const t=new o(this,e);e.user_id===this.application.me.id&&"LEFT"!==e.state&&(this.me=t),this.members[t.id]=t}});break;case"timestamp":this.timestamp=e.timestamp;break;case"sequence_number":this.sequence_number=e.sequence_number;break;case"member_id":const r={id:e.member_id,state:e.state,user:this.application.me};let n=this.members[e.member_id];if(n)Object.assign(n,r);else{const e=new o(this,r);this.me=e,this.members[e.id]=e}break;case"properties":this.is_video_conversation=e.properties.video;break}}join(e){const t={},r=e=>{return e?(e.user_id&&(t.user_id=e.user_id),e.user_name&&(t.user_name=e.user_name)):(this.me&&this.me.id&&"INVITED"===this.me.state&&(t.member_id=this.me.id),t.user_name=this.application.me.name,t.user_id=this.application.me.id),t};return new Promise((t,n)=>{const i=r(e);this.application.session.sendRequest({type:"conversation:join",cid:this.id,body:i},e=>{if("conversation:join:success"===e.type){const r=new o(this,e.body);return e.body.user_id===this.application.me.id&&(this.me=r),this.members[r.id]=r,this.application.getConversation(this.id).then(()=>t(r)).catch(()=>{return this.log.warn("Failed getting conversation after joining"),t(r)})}n(new l(e))})})}del(){return new Promise((e,t)=>{this.application.session.sendRequest({type:"conversation:delete",cid:this.id},r=>{"conversation:delete:success"===r.type?(delete this.application.conversations[this.id],e()):t(new l(r))})})}deleteEvent(e){return e.del()}invite(e){return e&&(e.id||e.user_name)?new Promise((t,r)=>{this.application.session.sendRequest({type:"conversation:invite",cid:this.id,body:{user_id:e.id,user_name:e.user_name,member_id_inviting:this.me.id,media:e.media}},e=>{if("conversation:invite:success"===e.type){const r=new o(this,e.body);this.members[r.id]=r,t(r)}else r(new l(e))})}):Promise.reject(new f("error:invite:missing:params"))}inviteWithAudio(e){return e&&(e.id||e.user_name)?(e.media={audio:{muted:!1,earmuffed:!1}},this.invite(e)):Promise.reject(new f("error:invite:missing:params"))}leave(){return this.me.kick()}sendText(e){return new Promise((t,r)=>{if(null===this.me)r(new f("error:self"));else{const n={type:"text",cid:this.id,from:this.me.id,body:{text:e}};this.application.session.sendRequest(n,e=>{if("text:success"===e.type){n.id=e.body.id,n.body.timestamp=e.body.timestamp;const r=new a(this,n);t(r)}else r(new l(e))})}})}sendImage(e,t={quality_ratio:100,medium_size_ratio:50,thumbnail_size_ratio:30}){const r=new FormData;r.append("file",e),r.append("quality_ratio",t.quality_ratio),r.append("medium_size_ratio",t.medium_size_ratio),r.append("thumbnail_size_ratio",t.thumbnail_size_ratio);const n=this.application.session.config.ips_url;return h.networkSend(n,r).then(e=>{return e.upload.addEventListener("progress",e=>{e.lengthComputable&&this.log.debug("uploading image "+e.loaded+"/"+e.total)},!1),e.onreadystatechange=(()=>{if(4===e.readyState&&200===e.status){const t={type:"image",cid:this.id,from:this.me.id,body:{representations:JSON.parse(e.responseText)}};this.application.session.sendRequest(t,e=>{"image:success"!==e.type&&this.log.debug(new l(e))}),this.log.info(e)}200!==e.status&&this.log.error(e)}),Promise.resolve(e)})}abortSendImage(e){return e instanceof XMLHttpRequest?e.abort():new f("error:invalid:param:type")}_typing(e){return new Promise((t,r)=>{const n={activity:"on"===e?1:0};this.application.session.sendRequest({type:"text:typing:"+e,cid:this.id,from:this.me.id,body:n},n=>{n.type==="text:typing:"+e+":success"?t(n.type):r(new l(n))})})}startTyping(){return this._typing("on")}stopTyping(){return this._typing("off")}getEvents(e){return new Promise((t,r)=>{this.application.session.sendRequest({type:"conversation:events",cid:this.id,body:e},e=>{if("conversation:events:success"===e.type){const r=new Map;for(let t in e.body)if(e.body.hasOwnProperty(t)){const n=e.body[t];switch(n.type){case"text":r.set(n.id,new a(this,n));break;case"image":r.set(n.id,new c(this,n));break;default:["member:joined","member:left","member:invited","member:media","audio:dtmf","audio:record","audio:record:done","audio:ringing:stop","say:text","audio:ringing:start"].includes(n.type)&&r.set(n.id,new s(this,n));break}}this.events=new Map([...this.events,...r]),t(this.events)}else r(new l(e))})})}_handleEvent(e){if(e.type.startsWith("rtc"))return void this.emit(e.type,e);this.sequence_number++,e.from&&!this.members[e.from]&&(this.members[e.from]=new o(this,e)),e.body&&e.body.event_id&&"string"===typeof e.body.event_id&&(e.body.event_id=parseInt(e.body.event_id));const t=this.members[e.from];let r=this.conversationEventHandler.handleEvent(e);["text:typing:on","text:typing:off"].includes(e.type)||this.events.set(r.id,r),this.emit(e.type,t,r)}}e.exports=m},4:function(e,t){},"40de":function(e,t){var r=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},4380:function(e,t){e.exports=class{constructor(){const e={get function(){return()=>{const e=self.IDBTransaction||self.webkitIDBTransaction;e&&(e.READ_WRITE=e.READ_WRITE||"readwrite",e.READ_ONLY=e.READ_ONLY||"readonly");let t=indexedDB.open("ConversationClient",2),r=!1,n=[];t.onupgradeneeded=(e=>{const t=e.target.result;t.objectStoreNames.contains("conversations")&&t.deleteObjectStore("conversations"),t.createObjectStore("conversations",{keyPath:"cid"}),t.objectStoreNames.contains("events")&&t.deleteObjectStore("events"),t.createObjectStore("events",{keyPath:"cid"})}),t.onsuccess=(()=>{r=!0,n.forEach(e=>{onmessage(e)}),self.postMessage({worker_action:"db:initialised"})}),t.onblocked=(()=>{}),t.onerror=(()=>{}),t.onabort=(()=>{}),t.oncomplete=(()=>{}),onmessageerror=(e=>{}),onmessage=(i=>{let o=null,s=null,a=null;if(r){if(t){const r={"conversations:invalidate":()=>{t=indexedDB.deleteDatabase("ConversationClient"),close(),self.postMessage({worker_action:"conversations:invalidate:success"})},"conversations:storage:add":()=>{o=t.result.transaction("conversations",e.READ_WRITE),s=o.objectStore("conversations"),s.put({cid:i.data.body.id,conversation:i.data}).onsuccess=(()=>{var e=s.count();e.onsuccess=(()=>{self.postMessage({worker_action:"conversations:idb:count",conversations_idb_count:e.result})})})},"conversation:storage:delete":()=>{o=t.result.transaction("events",e.READ_WRITE),a=o.objectStore("events"),a.delete(i.data.cid).onsuccess=(()=>{o=t.result.transaction("conversations",e.READ_WRITE),s=o.objectStore("conversations"),s.delete(i.data.cid).onsuccess=(()=>{})})},"events:storage:update":()=>{o=t.result.transaction("events",e.READ_WRITE),a=o.objectStore("events");var r=a.put({cid:i.data.cid,events:i.data});r.onsuccess=(e=>{}),r.onerror=(e=>{})},"events:storage:delete":()=>{o=t.result.transaction("events",e.READ_WRITE),a=o.objectStore("events"),a.delete(i.data.cid).onsuccess=(()=>{})},"events:storage:add":()=>{o=t.result.transaction("events",e.READ_WRITE),a=o.objectStore("events"),a.get(i.data.cid).onsuccess=(e=>{e.target.result&&e.target.result.events.body&&(e.target.result.events.body.push(i.data),a.put(e.target.result).onsuccess=(()=>{}))})},"events:storage:get":()=>{o=t.result.transaction("events",e.READ_ONLY),a=o.objectStore("events"),a.get(i.data.cid).onsuccess=(e=>{e.target.result&&(e.target.result.worker_action=i.data.worker_action,self.postMessage(e.target.result))})}};if(r.hasOwnProperty(i.data.worker_action))return r[i.data.worker_action].call(this)}}else n.push(i)})}}};if("undefined"!==typeof Blob){let t=e.function.toString();t=t.substring(t.indexOf("{")+1,t.lastIndexOf("}")),this.cache_worker_blob=new Blob([t],{type:"application/javascript"})}}}},"4a35":function(e,t,r){(function(t){function r(){return"undefined"!==typeof navigator?o(navigator.userAgent):i()}function n(e){var t=a(),r=t.filter(function(t){return t.rule&&t.rule.test(e)})[0];return r?r.name:null}function i(){var e="undefined"!==typeof t&&t.version;return e&&{name:"node",version:t.version.slice(1),os:t.platform}}function o(e){var t=s();if(!e)return null;var r=t.map(function(t){var r=t.rule.exec(e),n=r&&r[1].split(/[._]/).slice(0,3);return n&&n.length<3&&(n=n.concat(1==n.length?[0,0]:[0])),r&&{name:t.name,version:n.join(".")}}).filter(Boolean)[0]||null;return r&&(r.os=n(e)),/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/i.test(e)&&(r=r||{},r.bot=!0),r}function s(){return c([["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\ ([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/]])}function a(){return c([["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]])}function c(e){return e.map(function(e){return{name:e[0],rule:e[1]}})}e.exports={detect:r,detectOS:n,getNodeVersion:i,parseUserAgent:o}}).call(this,r("4362"))},"4f2a":function(e,t){t.encode=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},t.decode=function(e){for(var t={},r=e.split("&"),n=0,i=r.length;n<i;n++){var o=r[n].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},5113:function(e,t,r){const n=r("5c7d"),i=r("a4c8"),o=r("60f1"),s=r("3396"),a=s.NexmoClientError;class c extends i{constructor(e,t){super(e,t),this.log=n.getLogger(this.constructor.name),this.type="image",this.conversation=e,this.state={seen_by:{},delivered_to:{}},t&&t.body&&t.body.timestamp&&(this.timestamp=t.body.timestamp),Object.assign(this,t)}seen(){return super.seen()}delivered(){return super.delivered()}del(){return super.del()}fetchImage(e="thumbnail",t=this.body.representations){const r=t[e].url;return o.networkFetch(r).then(e=>{const t=new Uint8Array(e);let r="";const n=8192;let i;for(i=0;i<t.length/n;i++)r+=String.fromCharCode.apply(null,t.subarray(i*n,(i+1)*n));r+=String.fromCharCode.apply(null,t.subarray(i*n));const o=btoa(r),s="data:image/jpeg;base64,"+o;return Promise.resolve(s)}).catch(e=>{return this.log.warn(e),Promise.reject(new a("error:fetch-image"))})}}e.exports=c},5317:function(e,t){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,i=e.indexOf("["),o=e.indexOf("]");-1!=i&&-1!=o&&(e=e.substring(0,i)+e.substring(i,o).replace(/:/g,";")+e.substring(o,e.length));var s=r.exec(e||""),a={},c=14;while(c--)a[n[c]]=s[c]||"";return-1!=i&&-1!=o&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},"568d":function(e,t,r){var n=r("34eb")("socket.io-parser"),i=r("7297"),o=r("703e"),s=r("a23b"),a=r("f922");function c(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=c,t.Decoder=l;var d=t.ERROR+'"encode error"';function p(e){var r=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(r+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(r+=e.nsp+","),null!=e.id&&(r+=e.id),null!=e.data){var i=u(e.data);if(!1===i)return d;r+=i}return n("encoded %j as %s",e,r),r}function u(e){try{return JSON.stringify(e)}catch(e){return!1}}function h(e,t){function r(e){var r=o.deconstructPacket(e),n=p(r.packet),i=r.buffers;i.unshift(n),t(i)}o.removeBlobs(e,r)}function l(){this.reconstructor=null}function f(e){var r=0,i={type:Number(e.charAt(0))};if(null==t.types[i.type])return g("unknown packet type "+i.type);if(t.BINARY_EVENT===i.type||t.BINARY_ACK===i.type){var o="";while("-"!==e.charAt(++r))if(o+=e.charAt(r),r==e.length)break;if(o!=Number(o)||"-"!==e.charAt(r))throw new Error("Illegal attachments");i.attachments=Number(o)}if("/"===e.charAt(r+1)){i.nsp="";while(++r){var a=e.charAt(r);if(","===a)break;if(i.nsp+=a,r===e.length)break}}else i.nsp="/";var c=e.charAt(r+1);if(""!==c&&Number(c)==c){i.id="";while(++r){a=e.charAt(r);if(null==a||Number(a)!=a){--r;break}if(i.id+=e.charAt(r),r===e.length)break}i.id=Number(i.id)}if(e.charAt(++r)){var d=m(e.substr(r)),p=!1!==d&&(i.type===t.ERROR||s(d));if(!p)return g("invalid payload");i.data=d}return n("decoded %s as %j",e,i),i}function m(e){try{return JSON.parse(e)}catch(e){return!1}}function v(e){this.reconPack=e,this.buffers=[]}function g(e){return{type:t.ERROR,data:"parser error: "+e}}c.prototype.encode=function(e,r){if(n("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)h(e,r);else{var i=p(e);r([i])}},i(l.prototype),l.prototype.add=function(e){var r;if("string"===typeof e)r=f(e),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new v(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!a(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");r=this.reconstructor.takeBinaryData(e),r&&(this.reconstructor=null,this.emit("decoded",r))}},l.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},v.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=o.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},v.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},"58b1":function(e,t,r){(function(t){var n=r("e82e"),i=Object.prototype.toString,o="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===i.call(Blob),s="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===i.call(File);function a(e){if(!e||"object"!==typeof e)return!1;if(n(e)){for(var r=0,i=e.length;r<i;r++)if(a(e[r]))return!0;return!1}if("function"===typeof t&&t.isBuffer&&t.isBuffer(e)||"function"===typeof ArrayBuffer&&e instanceof ArrayBuffer||o&&e instanceof Blob||s&&e instanceof File)return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return a(e.toJSON(),!0);for(var c in e)if(Object.prototype.hasOwnProperty.call(e,c)&&a(e[c]))return!0;return!1}e.exports=a}).call(this,r("b639").Buffer)},"5a10":function(e,t,r){const n=r("a7b3"),i=r("5c7d"),o=r("e795"),s=r("38c5"),a=r("9fca"),c=r("a899"),d=r("2334"),p=r("3396"),u=p.NexmoApiError,h=p.NexmoClientError;let l=null,f=null;class m{constructor(e,t){this.log=i.getLogger(this.constructor.name),this.session=e,this.conversations={},this.synced_conversations_count=0,this.start_sync_time=0,this.stop_sync_time=0,this.calls=new Map,this._call_draft_list=new Map,l=new c(this),f=new d(this),this.me=null,Object.assign(this,t),n.mixin(m)}updateOrCreateConversation(e){const t=this.conversations[e.id];return t?(t._updateObjectInstance(e),this.conversations[e.id]=t):this.conversations[e.id]=new s(this,e),this.conversations[e.id]}_handleEvent(e){const t=e.body&&e.body.user&&e.body.user.user_id===this.me.id;e.type.startsWith("sip")?l._handleSipCallEvent(e):e.cid in this.conversations?(this.conversations[e.cid]._handleEvent(e),"member:joined"!==e.type&&"member:invited"!==e.type||!t||this._handleApplicationEvent(e)):this.getConversation(e.cid).then(t=>{this.conversations[e.cid]=t,t._handleEvent(e),this._handleApplicationEvent(e)}).catch(e=>{this.log.error(e)})}updateToken(e){return new Promise((t,r)=>{this.session.sendRequest({type:"session:update-token",body:{token:e}},n=>{"session:update-token:success"===n.type?(this.me&&this.session._updateTokenInCache(e,this.me.name),t()):r(new u(n))})})}_handleApplicationEvent(e){const t=f.handleEvent(e);this.emit(t.type,this.conversations[e.cid].members[t.from],t)}call(e){return new Promise((t,r)=>{if(!e||!Array.isArray(e)||0===e.length)return r(new h("error:application:call:params"));const n=new a(this);return n.createCall(e).then(()=>{return n.direction=n.CALL_DIRECTION.OUTBOUND,t(n)})})}callPhone(e){return new Promise((t,r)=>{if(!e||"string"!==typeof e)return r(new h("error:application:callPhone:params"));const n=new a(this);return n.direction=n.CALL_DIRECTION.OUTBOUND,n.createPhoneCall(e).then(e=>{return n.knocking_id=e.body.id,this._call_draft_list.set(n.knocking_id,n),t(n)})})}newConversation(e){return new Promise((t,r)=>{this.session.sendRequest({type:"new:conversation",body:e},e=>{if("new:conversation:success"===e.type){const r=new s(this,e.body);this.conversations[r.id]=r,this.getConversation(r.id).then(e=>{t(e)})}else r(new u(e))})})}newConversationAndJoin(e){return this.newConversation(e).then(e=>{return e.join().then(()=>{return e})})}getConversation(e){return new Promise((t,r)=>{this.session.sendRequest({type:"conversation:get",cid:e,body:{}},e=>{if("conversation:get:success"===e.type){const r=this.updateOrCreateConversation(e.body);r.getEvents().then(e=>{r.events=e,t(r)})}else r(new u(e))})})}getConversations(e){return new Promise((t,r)=>{this.session.sendRequest({type:"user:conversations",body:e},e=>{"user:conversations:success"===e.type?(e.body.forEach(e=>{this.updateOrCreateConversation(e)}),this.syncConversations(e.body),t(this.conversations)):r(new u(e))})})}syncConversations(e){const t=e.length,r=new Date;this.start_sync_time="undefined"!==typeof window&&window.performance?window.performance.now():r.getTime();const n=()=>{this.synced_conversations_percentage=(this.synced_conversations_count/t*100).toFixed(2);const r={sync_progress:this.synced_conversations_percentage};if(this.emit("sync:progress",r),this.log.debug("Loading sync progress: "+this.synced_conversations_count+"/"+t+" - "+this.synced_conversations_percentage+"%"),this.synced_conversations_percentage>=100){const e=new Date;this.stop_sync_time="undefined"!==typeof window&&window.performance?window.performance.now():e.getTime(),this.log.info("Loaded conversations in "+(this.stop_sync_time-this.start_sync_time)+"ms")}this.synced_conversations_count<t&&(this.getConversation(e[this.synced_conversations_count].id).then(()=>{n()}),this.synced_conversations_count++,this.sync_progress_buffer++)};n()}getUser(e=this.me.id){return new Promise((t,r)=>{const n={user_id:e};this.session.sendRequest({type:"user:get",from:this.me.id,body:n},e=>{"user:get:success"===e.type?t(new o(this,e.body)):r(new u(e))})})}}e.exports=m},"5a6e":function(e,t,r){(function(e){var n,i=r("764b"),o=r("58b1"),s=r("ca99"),a=r("ccc1"),c=r("a081");e&&e.ArrayBuffer&&(n=r("8390"));var d="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),p="undefined"!==typeof navigator&&/PhantomJS/i.test(navigator.userAgent),u=d||p;t.protocol=3;var h=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},l=i(h),f={type:"error",data:"parser error"},m=r("d780");function v(e,r){var n="b"+t.packets[e.type]+e.data.data;return r(n)}function g(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var i=e.data,o=new Uint8Array(i),s=new Uint8Array(1+i.byteLength);s[0]=h[e.type];for(var a=0;a<o.length;a++)s[a+1]=o[a];return n(s.buffer)}function y(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var i=new FileReader;return i.onload=function(){e.data=i.result,t.encodePacket(e,r,!0,n)},i.readAsArrayBuffer(e.data)}function b(e,r,n){if(!r)return t.encodeBase64Packet(e,n);if(u)return y(e,r,n);var i=new Uint8Array(1);i[0]=h[e.type];var o=new m([i.buffer,e.data]);return n(o)}function w(e){try{e=c.decode(e,{strict:!1})}catch(e){return!1}return e}function C(e,t,r){for(var n=new Array(e.length),i=a(e.length,r),o=function(e,r,i){t(r,function(t,r){n[e]=r,i(t,n)})},s=0;s<e.length;s++)o(s,e[s],i)}t.encodePacket=function(t,r,n,i){"function"===typeof r&&(i=r,r=!1),"function"===typeof n&&(i=n,n=null);var o=void 0===t.data?void 0:t.data.buffer||t.data;if(e.ArrayBuffer&&o instanceof ArrayBuffer)return g(t,r,i);if(m&&o instanceof e.Blob)return b(t,r,i);if(o&&o.base64)return v(t,i);var s=h[t.type];return void 0!==t.data&&(s+=n?c.encode(String(t.data),{strict:!1}):String(t.data)),i(""+s)},t.encodeBase64Packet=function(r,n){var i,o="b"+t.packets[r.type];if(m&&r.data instanceof e.Blob){var s=new FileReader;return s.onload=function(){var e=s.result.split(",")[1];n(o+e)},s.readAsDataURL(r.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(r.data))}catch(e){for(var a=new Uint8Array(r.data),c=new Array(a.length),d=0;d<a.length;d++)c[d]=a[d];i=String.fromCharCode.apply(null,c)}return o+=e.btoa(i),n(o)},t.decodePacket=function(e,r,n){if(void 0===e)return f;if("string"===typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),r);if(n&&(e=w(e),!1===e))return f;var i=e.charAt(0);return Number(i)==i&&l[i]?e.length>1?{type:l[i],data:e.substring(1)}:{type:l[i]}:f}var o=new Uint8Array(e),a=(i=o[0],s(e,1));return m&&"blob"===r&&(a=new m([a])),{type:l[i],data:a}},t.decodeBase64Packet=function(e,t){var r=l[e.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:e.substr(1)}};var i=n.decode(e.substr(1));return"blob"===t&&m&&(i=new m([i])),{type:r,data:i}},t.encodePayload=function(e,r,n){"function"===typeof r&&(n=r,r=null);var i=o(e);if(r&&i)return m&&!u?t.encodePayloadAsBlob(e,n):t.encodePayloadAsArrayBuffer(e,n);if(!e.length)return n("0:");function s(e){return e.length+":"+e}function a(e,n){t.encodePacket(e,!!i&&r,!1,function(e){n(null,s(e))})}C(e,a,function(e,t){return n(t.join(""))})},t.decodePayload=function(e,r,n){if("string"!==typeof e)return t.decodePayloadAsBinary(e,r,n);var i;if("function"===typeof r&&(n=r,r=null),""===e)return n(f,0,1);for(var o,s,a="",c=0,d=e.length;c<d;c++){var p=e.charAt(c);if(":"===p){if(""===a||a!=(o=Number(a)))return n(f,0,1);if(s=e.substr(c+1,o),a!=s.length)return n(f,0,1);if(s.length){if(i=t.decodePacket(s,r,!1),f.type===i.type&&f.data===i.data)return n(f,0,1);var u=n(i,c+o,d);if(!1===u)return}c+=o,a=""}else a+=p}return""!==a?n(f,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,r){if(!e.length)return r(new ArrayBuffer(0));function n(e,r){t.encodePacket(e,!0,!0,function(e){return r(null,e)})}C(e,n,function(e,t){var n=t.reduce(function(e,t){var r;return r="string"===typeof t?t.length:t.byteLength,e+r.toString().length+r+2},0),i=new Uint8Array(n),o=0;return t.forEach(function(e){var t="string"===typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),s=0;s<e.length;s++)n[s]=e.charCodeAt(s);r=n.buffer}i[o++]=t?0:1;var a=r.byteLength.toString();for(s=0;s<a.length;s++)i[o++]=parseInt(a[s]);i[o++]=255;for(n=new Uint8Array(r),s=0;s<n.length;s++)i[o++]=n[s]}),r(i.buffer)})},t.encodePayloadAsBlob=function(e,r){function n(e,r){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"===typeof e){for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);e=n.buffer,t[0]=0}var o=e instanceof ArrayBuffer?e.byteLength:e.size,s=o.toString(),a=new Uint8Array(s.length+1);for(i=0;i<s.length;i++)a[i]=parseInt(s[i]);if(a[s.length]=255,m){var c=new m([t.buffer,a.buffer,e]);r(null,c)}})}C(e,n,function(e,t){return r(new m(t))})},t.decodePayloadAsBinary=function(e,r,n){"function"===typeof r&&(n=r,r=null);var i=e,o=[];while(i.byteLength>0){for(var a=new Uint8Array(i),c=0===a[0],d="",p=1;;p++){if(255===a[p])break;if(d.length>310)return n(f,0,1);d+=a[p]}i=s(i,2+d.length),d=parseInt(d);var u=s(i,0,d);if(c)try{u=String.fromCharCode.apply(null,new Uint8Array(u))}catch(e){var h=new Uint8Array(u);u="";for(p=0;p<h.length;p++)u+=String.fromCharCode(h[p])}o.push(u),i=s(i,d)}var l=o.length;o.forEach(function(e,i){n(t.decodePacket(e,r,!0),i,l)})}}).call(this,r("c8ba"))},"5c7d":function(e,t,r){var n,i;(function(o,s){"use strict";n=s,i="function"===typeof n?n.call(t,r,t,e):n,void 0===i||(e.exports=i)})(0,function(){"use strict";var e=function(){},t="undefined",r=["trace","debug","info","warn","error"];function n(e,t){var r=e[t];if("function"===typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function i(r){return"debug"===r&&(r="log"),typeof console!==t&&(void 0!==console[r]?n(console,r):void 0!==console.log?n(console,"log"):e)}function o(t,n){for(var i=0;i<r.length;i++){var o=r[i];this[o]=i<t?e:this.methodFactory(o,t,n)}this.log=this.debug}function s(e,r,n){return function(){typeof console!==t&&(o.call(this,r,n),this[e].apply(this,arguments))}}function a(e,t,r){return i(e)||s.apply(this,arguments)}function c(e,n,i){var s,c=this,d="loglevel";function p(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t){try{return void(window.localStorage[d]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(d)+"="+n+";"}catch(e){}}}function u(){var e;if(typeof window!==t){try{e=window.localStorage[d]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,n=r.indexOf(encodeURIComponent(d)+"=");-1!==n&&(e=/^([^;]+)/.exec(r.slice(n))[1])}catch(e){}return void 0===c.levels[e]&&(e=void 0),e}}e&&(d+=":"+e),c.name=e,c.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},c.methodFactory=i||a,c.getLevel=function(){return s},c.setLevel=function(r,n){if("string"===typeof r&&void 0!==c.levels[r.toUpperCase()]&&(r=c.levels[r.toUpperCase()]),!("number"===typeof r&&r>=0&&r<=c.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(s=r,!1!==n&&p(r),o.call(c,r,e),typeof console===t&&r<c.levels.SILENT)return"No console available for logging"},c.setDefaultLevel=function(e){u()||c.setLevel(e,!1)},c.enableAll=function(e){c.setLevel(c.levels.TRACE,e)},c.disableAll=function(e){c.setLevel(c.levels.SILENT,e)};var h=u();null==h&&(h=null==n?"WARN":n),c.setLevel(h,!1)}var d=new c,p={};d.getLogger=function(e){if("string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=p[e];return t||(t=p[e]=new c(e,d.getLevel(),d.methodFactory)),t};var u=typeof window!==t?window.log:void 0;return d.noConflict=function(){return typeof window!==t&&window.log===d&&(window.log=u),d},d.getLoggers=function(){return p},d})},"5e64":function(e,t,r){"use strict";e.exports=function(e){var t=e&&e.navigator,r=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject(r(e))})}}},"60f1":function(e,t,r){var n=r("11c1");class i{static getMemberFromNameOrNull(e,t){if(!e||!t)return null;for(var r in e.members)if(e.members[r].user.name===t)return e.members[r];return null}static networkFetch(e,t){return i.getToken().then(r=>{return new Promise((n,i)=>{const o=new XMLHttpRequest;o.open("GET",e),o.setRequestHeader("Authorization","Bearer "+r),o.responseType="arraybuffer",o.onload=function(){4===o.readyState&&200===o.status&&n(this.response)},o.onerror=(e=>{i(new NexmoClientError(e))}),o.send(t)})})}static networkSend(e,t){return i.getToken().then(r=>{return new Promise((n,i)=>{const o=new XMLHttpRequest;o.open("POST",e),o.setRequestHeader("Authorization","Bearer "+r),o.onloadstart=(()=>{n(o)}),o.onerror=(e=>{i(new NexmoClientError(e))}),o.send(t)})})}static getToken(){return localStorage.getItem("NXMO_user_data")?Promise.resolve(JSON.parse(localStorage.getItem("NXMO_user_data")).token):Promise.reject(new NexmoClientError("error:user:relogin"))}static allocateUUID(){return n.v4()}}e.exports=i},"62e4":function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},"62fa":function(e,t){e.exports=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},6536:function(e,t,r){"use strict";var n=r("955b");e.exports=function(e,t){var r=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var o="string"===typeof i;return o&&(i=[i]),i=i.filter(function(e){var n=0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!r;return n?(r=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=o?i[0]:i,!!i.length}})}},6668:function(e,t,r){const n=r("a4c8");class i extends n{constructor(e,t){super(e,t),this.type="text",this.conversation=e,this.state={seen_by:{},delivered_to:{}},t&&t.body&&t.body.timestamp&&(this.timestamp=t.body.timestamp),Object.assign(this,t)}seen(){return super.seen()}delivered(){return super.delivered()}del(){return super.del()}}e.exports=i},"66ff":function(e,t,r){const n=r("a7b3"),i=r("a4c8"),o=r("3396"),s=o.NexmoApiError;o.NexmoClientError;class a{constructor(e,t){this.conversation=e,this._normalise(t),n.mixin(a)}_normalise(e){if(e){this.user=this.user||{},this.channel=e.channel||{type:"app"};for(let t in e)switch(t){case"member_id":this.id=e.member_id;break;case"timestamp":this.timestamp=e.timestamp;break;case"state":this.state=e.state;break;case"from":this.id=e.from;break;case"user_id":this.user.id=e.user_id;break;case"name":this.user.name=e.name;break;case"user":this.user={name:e.user.name,id:e.user.user_id||e.user.id};break;case"invited_by":this.invited_by=e.invited_by;break;case"conversation":break;default:e.type||(this[t]=e[t])}this.conversation.application.me&&e.user_id===this.conversation.application.me.id&&(this.user.name=this.conversation.application.me.name),delete this.user_id,delete this.name,delete this.user.user_id}}playStream(e){return new Promise((t,r)=>{this.conversation.application.session.sendRequest({type:"audio:play",cid:this.id,to:this.id,body:e},e=>{"audio:play:success"===e.type?t(new i(this.conversation,e)):r(new s(e))})})}sayText(e){return new Promise((t,r)=>{this.conversation.application.session.sendRequest({type:"audio:say",cid:this.id,from:this.conversation.me.id,to:this.id,body:e},e=>{"audio:say:success"===e.type?t(new i(this.conversation,e)):r(new s(e))})})}kick(){return new Promise((e,t)=>{this.conversation.application.session.sendRequest({type:"conversation:member:delete",cid:this.conversation.id,from:this.conversation.me.id,to:this.id,body:{member_id:this.id}},r=>{"conversation:member:delete:success"===r.type?e(r.body):t(new s(r))})})}mute(e){return this.conversation.media.mute(e)}earmuff(e){return this.conversation.media.earmuff(e)}_handleEvent(e){switch(e.type){case"member:invited":this._normalise(e.body),this.state="INVITED",this.timestamp.invited=e.body.timestamp.invited;break;case"member:joined":this._normalise(e.body),this.state="JOINED",this.timestamp.joined=e.body.timestamp.joined;break;case"member:left":this._normalise(e.body),this.state="LEFT",this.timestamp.left=e.body.timestamp.left;break;case"member:media":this.media=e.body;break;default:break}}}e.exports=a},"6a44":function(e,t,r){(function(e){var n=r("01d3"),i=r("d33e"),o=r("0a5e"),s=r("0882");function a(t){var r,s=!1,a=!1,c=!1!==t.jsonp;if(e.location){var d="https:"===location.protocol,p=location.port;p||(p=d?443:80),s=t.hostname!==location.hostname||p!==t.port,a=t.secure!==d}if(t.xdomain=s,t.xscheme=a,r=new n(t),"open"in r&&!t.forceJSONP)return new i(t);if(!c)throw new Error("JSONP disabled");return new o(t)}t.polling=a,t.websocket=s}).call(this,r("c8ba"))},"703e":function(e,t,r){(function(e){var n=r("a23b"),i=r("f922"),o=Object.prototype.toString,s="function"===typeof e.Blob||"[object BlobConstructor]"===o.call(e.Blob),a="function"===typeof e.File||"[object FileConstructor]"===o.call(e.File);function c(e,t){if(!e)return e;if(i(e)){var r={_placeholder:!0,num:t.length};return t.push(e),r}if(n(e)){for(var o=new Array(e.length),s=0;s<e.length;s++)o[s]=c(e[s],t);return o}if("object"===typeof e&&!(e instanceof Date)){o={};for(var a in e)o[a]=c(e[a],t);return o}return e}function d(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(n(e))for(var r=0;r<e.length;r++)e[r]=d(e[r],t);else if("object"===typeof e)for(var i in e)e[i]=d(e[i],t);return e}t.deconstructPacket=function(e){var t=[],r=e.data,n=e;return n.data=c(r,t),n.attachments=t.length,{packet:n,buffers:t}},t.reconstructPacket=function(e,t){return e.data=d(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){function r(e,d,p){if(!e)return e;if(s&&e instanceof Blob||a&&e instanceof File){o++;var u=new FileReader;u.onload=function(){p?p[d]=this.result:c=this.result,--o||t(c)},u.readAsArrayBuffer(e)}else if(n(e))for(var h=0;h<e.length;h++)r(e[h],h,e);else if("object"===typeof e&&!i(e))for(var l in e)r(e[l],l,e)}var o=0,c=e;r(c),o||t(c)}}).call(this,r("c8ba"))},7297:function(e,t,r){function n(e){if(e)return i(e)}function i(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n)r[n].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},"74ba":function(e,t,r){const n=r("a7b3"),i=r("8055"),o=r("5c7d"),s=r("d306"),a=r("60f1"),c=r("239e"),d=r("5a10"),p=r("eac1"),u=r("e795");s.reg(o),s.apply(o,{template:"[%t] %l (NXM-%n):",timestampFormatter:e=>{return e.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},levelFormatter:e=>{return e.toUpperCase()},nameFormatter:e=>{return e||"SDK"}});const h=r("3396"),l=h.NexmoApiError,f=h.NexmoClientError;class m{constructor(e){const t=e||{},r=this.config={autoConnect:!0,bugsnag_key:"cd2dcd56892c3cd260b12caf6eecf022",cache:!0,debug:!1,enable_log_reporter:!0,environment:"production",forceNew:!0,ips_url:"https://api.nexmo.com/v1/image",path:"/rtc",reconnection:!0,repository:"https://github.com/Nexmo/conversation-js-sdk",screenShareExtensionId:"",SDK_version:"2.1.0-beta.6",url:"https://ws.nexmo.com",iceServers:[{urls:"stun:stun.l.google.com:19302"}],rtcstats_enabled:!1,rtcstats_url:"",rtcstats_events:!1};let s;if(this.sessionReady=!1,this.requests={},this.application=null,Object.assign(this.config,t),!0===r.debug?o.setLevel("debug"):o.setLevel("silent"),this.log=o.noConflict(),r.enable_log_reporter){function a(e,t){let r=document.getElementsByTagName("head")[0],n=document.createElement("script");n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){n.readyState&&!/loaded|complete/.test(n.readyState)||(n.onload=n.onreadystatechange=null,n=void 0,t&&t())},r.insertBefore(n,r.firstChild)}"undefined"!==typeof document&&a("//d2wy8f7a9ursnm.cloudfront.net/bugsnag-3.min.js",()=>{"undefined"!==typeof Bugsnag&&(Bugsnag.apiKey||(Bugsnag.apiKey=this.config.bugsnag_key,Bugsnag.releaseStage=this.config.environment,Bugsnag.appVersion=this.config.SDK_version,Bugsnag.repository=this.config.repository,Bugsnag.disableAutoBreadcrumbs()))})}s=i.connect(r.url,{path:r.path,forceNew:r.forceNew,reconnection:r.reconnection,autoConnect:r.autoConnect,transports:["websocket"]}),this.connection=s,r.cache&&(this.cache=new c(this),this.cache.init(this)),s.on("connect",()=>{this.emit("ready"),this.sessionReady=!0,this.log.info("websocket ready")}),s.on("connecting",()=>{this.emit("connecting"),this.log.info("websocket connecting")}),s.on("disconnect",()=>{this.emit("disconnect"),this.log.info("websocket disconnected")}),s.on("reconnect",e=>{this.emit("reconnect",e),this.cache&&this.cache.user_data&&(this.login(this.cache.user_data.token),this.log.info("websocket reconnected"))}),s.on("reconnecting",e=>{this.emit("reconnecting",e),this.log.info("websocket reconnecting")}),s.on("error",e=>{this.emit("error",new f(e)),this.log.error("Socket.io reported a generic error",e)}),s.io.on("packet",e=>{if(2!==e.type)return;if("echo"===e.data[0])return;const t=e.data[1];if(t.type=e.data[0],this.log.debug("<--",t.type,t),t.rid in this.requests){const e=this.requests[t.rid].callback;delete this.requests[t.rid],delete t.delay,this.errorsEmitter&&this.errorsEmitter.emitResponseIfError(t),e(t)}else this.application&&this.application._handleEvent(t)}),n.mixin(m)}sendRequest(e,t){e.tid=a.allocateUUID();const r=e.type;delete e.type,this.log.debug("--\x3e",r,e),this.log.info("--\x3e",r,e.tid),this.connection.emit(r,e),this.requests[e.tid]={type:r,request:e,callback:t}}login(e){return new Promise((t,r)=>{"undefined"!==typeof Storage&&localStorage.removeItem("NXMO_user_data"),this.sendRequest({type:"session:login",body:{token:e,SDK_version:this.config.SDK_version,OS_family:"js",OS_revision:"undefined"!==typeof navigator?navigator.userAgent:"undefined"!==typeof window?window.navigator.userAgent:"Generic JS navigator"}},n=>{"session:success"===n.type?((!this.application||this.application.me&&this.application.me.id!==n.body.user_id)&&(this.application=new d(this)),this.application.me||(this.application.me=new u(this.application,{id:n.body.user_id,name:n.body.name})),this.errorsEmitter||(this.errorsEmitter=new p(this.application)),this._updateTokenInCache(e,n.body.name),"undefined"!==typeof Bugsnag&&(Bugsnag.user={id:this.application.me.id}),this.application.getConversations().then(()=>{t(this.application)},e=>{r(new l(e))})):(r(new l(n)),this.cache&&this.cache.worker&&this.cache.worker.terminate())})})}logout(){return new Promise((e,t)=>{const r=()=>{return this.sendRequest({type:"session:logout",body:{}},r=>{"session:logged-out"===r.type||"session:terminated"===r.type?(this.disconnect(),delete this.errorsEmitter,delete this.application,delete this.cache,this.callbacks={},this.requests={},this.sessionReady=!1,e(r)):(t(new l(r)),"undefined"!==typeof Bugsnag&&Bugsnag.notifyException(Error(r.reason)))})};if(this.application){let e=[];for(let t in this.application.conversations)e.push(this.application.conversations[t].media.disable());Promise.all(e).catch(e=>{this.log.info(e)}).then(()=>{r()})}else r()})}disconnect(){return this.connection.disconnect()}connect(){return this.connection.connect()}_updateTokenInCache(e,t){this.cache&&this.cache.updateToken({token:e,username:t})}}e.exports=m},"764b":function(e,t){e.exports=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},"78eb":function(e,t,r){var n=r("94ac"),i=r("2851"),o=r("7297"),s=r("568d"),a=r("d838"),c=r("40de"),d=r("34eb")("socket.io-client:manager"),p=r("ee34"),u=r("0b64"),h=Object.prototype.hasOwnProperty;function l(e,t){if(!(this instanceof l))return new l(e,t);e&&"object"===typeof e&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new u({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=t.parser||s;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}e.exports=l,l.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)h.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},l.prototype.updateSocketIds=function(){for(var e in this.nsps)h.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},l.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},o(l.prototype),l.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},l.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},l.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},l.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},l.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},l.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},l.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},l.prototype.open=l.prototype.connect=function(e,t){if(d("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;d("opening %s",this.uri),this.engine=n(this.uri,this.opts);var r=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var o=a(r,"open",function(){i.onopen(),e&&e()}),s=a(r,"error",function(t){if(d("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else i.maybeReconnectOnOpen()});if(!1!==this._timeout){var c=this._timeout;d("connect attempt will timeout after %d",c);var p=setTimeout(function(){d("connect attempt timed out after %d",c),o.destroy(),r.close(),r.emit("error","timeout"),i.emitAll("connect_timeout",c)},c);this.subs.push({destroy:function(){clearTimeout(p)}})}return this.subs.push(o),this.subs.push(s),this},l.prototype.onopen=function(){d("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(a(e,"data",c(this,"ondata"))),this.subs.push(a(e,"ping",c(this,"onping"))),this.subs.push(a(e,"pong",c(this,"onpong"))),this.subs.push(a(e,"error",c(this,"onerror"))),this.subs.push(a(e,"close",c(this,"onclose"))),this.subs.push(a(this.decoder,"decoded",c(this,"ondecoded")))},l.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},l.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},l.prototype.ondata=function(e){this.decoder.add(e)},l.prototype.ondecoded=function(e){this.emit("packet",e)},l.prototype.onerror=function(e){d("error",e),this.emitAll("error",e)},l.prototype.socket=function(e,t){var r=this.nsps[e];if(!r){r=new i(this,e,t),this.nsps[e]=r;var n=this;r.on("connecting",o),r.on("connect",function(){r.id=n.generateId(e)}),this.autoConnect&&o()}function o(){~p(n.connecting,r)||n.connecting.push(r)}return r},l.prototype.destroy=function(e){var t=p(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},l.prototype.packet=function(e){d("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()}))},l.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},l.prototype.cleanup=function(){d("cleanup");for(var e=this.subs.length,t=0;t<e;t++){var r=this.subs.shift();r.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},l.prototype.close=l.prototype.disconnect=function(){d("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},l.prototype.onclose=function(e){d("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},l.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)d("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();d("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout(function(){e.skipReconnect||(d("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(d("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(d("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(r)}})}},l.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},8055:function(e,t,r){var n=r("cc9e"),i=r("568d"),o=r("78eb"),s=r("34eb")("socket.io-client");e.exports=t=c;var a=t.managers={};function c(e,t){"object"===typeof e&&(t=e,e=void 0),t=t||{};var r,i=n(e),c=i.source,d=i.id,p=i.path,u=a[d]&&p in a[d].nsps,h=t.forceNew||t["force new connection"]||!1===t.multiplex||u;return h?(s("ignoring socket cache for %s",c),r=o(c,t)):(a[d]||(s("new io instance for %s",c),a[d]=o(c,t)),r=a[d]),i.query&&!t.query&&(t.query=i.query),r.socket(i.path,t)}t.protocol=i.protocol,t.connect=c,t.Manager=r("78eb"),t.Socket=r("2851")},8204:function(e,t,r){"use strict";var n=r("282b"),i=r("955b");e.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),i=n.parseCandidate(e.candidate),o=Object.assign(r,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,i.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"===typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var r=t.createObjectURL.bind(t),n=t.revokeObjectURL.bind(t),o=new Map,s=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++s;return o.set(t,e),i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return r(e)},t.revokeObjectURL=function(e){n(e),o.delete(e)};var a=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return a.get.apply(this)},set:function(e){return this.srcObject=o.get(e)||null,a.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=o.get(arguments[1])||null),c.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=i.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return"undefined"===typeof this._sctp?null:this._sctp}});var r=function(e){var t=n.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=n.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},o=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!==r?-1:r},s=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},a=function(e,r){var i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);var o=n.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?i=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(i=2147483637),i},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;if(e._sctp=null,r(arguments[0])){var t,n=o(arguments[0]),i=s(n),d=a(arguments[0],n);t=0===i&&0===d?Number.POSITIVE_INFINITY:0===i||0===d?Math.max(i,d):Math.min(i,d);var p={};Object.defineProperty(p,"maxMessageSize",{get:function(){return t}}),e._sctp=p}return c.apply(e,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=this,n=t.apply(e,arguments);return r(n,e),n},i.wrapPeerConnectionEvent(e,"datachannel",function(e){return r(e.channel,e.target),e})}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}}}},8283:function(e,t,r){"use strict";var n=r("955b");e.exports={shimLocalStreamsAPI:function(e){if("object"===typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(r){r.id===e&&(t=r)}),this._remoteStreams&&this._remoteStreams.forEach(function(r){r.id===e&&(t=r)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var r=this;e.getTracks().forEach(function(n){t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?-1===this._localStreams.indexOf(r)&&this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var r=this,n=e.getTracks();this.getSenders().forEach(function(e){-1!==n.indexOf(e.track)&&r.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){if("object"===typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}},shimCallbacksAPI:function(e){if("object"===typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var a=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=a,a=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=a,a=function(e,t,r){var n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=a}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var s=e.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,delete s.url,i.push(s)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"===typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var r=this;if(e){"undefined"!==typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=r.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||r.addTransceiver("audio"),"undefined"!==typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=r.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||r.addTransceiver("video")}return t.apply(r,arguments)}}}},8390:function(e,t){(function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<e.length;n++)r[e.charCodeAt(n)]=n;t.encode=function(t){var r,n=new Uint8Array(t),i=n.length,o="";for(r=0;r<i;r+=3)o+=e[n[r]>>2],o+=e[(3&n[r])<<4|n[r+1]>>4],o+=e[(15&n[r+1])<<2|n[r+2]>>6],o+=e[63&n[r+2]];return i%3===2?o=o.substring(0,o.length-1)+"=":i%3===1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,n,i,o,s,a=.75*e.length,c=e.length,d=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var p=new ArrayBuffer(a),u=new Uint8Array(p);for(t=0;t<c;t+=4)n=r[e.charCodeAt(t)],i=r[e.charCodeAt(t+1)],o=r[e.charCodeAt(t+2)],s=r[e.charCodeAt(t+3)],u[d++]=n<<2|i>>4,u[d++]=(15&i)<<4|o>>2,u[d++]=(3&o)<<6|63&s;return p}})()},"8a6d":function(e,t,r){const n=r("3396"),i=r("ec44"),o=r("f905"),s=r("29d2"),a=r("5c7d"),c=r("60f1"),d=n.NexmoApiError,p=n.NexmoClientError;class u{constructor(e){this.log=a.getLogger(this.constructor.name),e?(this.rtcHelper=new i,this.application=e.application,this.application.activeStream={},this.application.activeStreams=[],this.eventsQueue=[],this.parentConversation=e,this.parentConversation.remoteMembers=[],this.parentConversation.rtcObjects={},this.rtcNewPromises=[],this.streamIndex=0,this.rtcstats_enabled=this.application.session.config&&this.application.session.config.rtcstats_enabled,this.rtcstats_events=this.application.session.config&&this.application.session.config.rtcstats_events,this.application.session.config&&""!==this.application.session.config.screenShareExtensionId&&this.rtcHelper._setScreenShareExtensionId(this.application.session.config.screenShareExtensionId),this.rtcstats_enabled&&this._initStatsReporting()):this.log.warn("No conversation object in Media")}_enableStatsReporting(){this.application.session.config.rtcstats_enabled=!0,this._initStatsReporting()}_enableStatsEvents(){this.application.session.config.rtcstats_events=!0,this._initStatsEvents()}_initStatsReporting(){this.rtcHelper.isNode()||(this.rtcStats_wsConnection=new o,this.rtcStats=new s(this.rtcStats_wsConnection.trace,!1,1e3,[""]),this.application.session.config.rtcstats_url&&this.rtcStats_wsConnection.init({rtcstatsUri:this.application.session.config.rtcstats_url}))}_initStatsEvents(){if(!this.rtcHelper.isNode()){const e=(e,t,r)=>{"mos"===e&&t&&this.application.emit("rtcstats:report",t,r,this.parentConversation)};this.rtcStats=new s(e,!0,1e3,[""])}}_disableStatsReporting(){this.application.session.config.rtcstats_enabled=!1,this.this.rtcStats_wsConnection.disable()}_disableStatsEvents(){this.application.session.config.rtcstats_events=!1,this.rtcStats.disable()}_handleVideo(e){return Promise.resolve().then(()=>{if(e.video){let t,r,n="none",i="video";switch(e.video===Object(e.video)?(n=e.video.direction,i=e.video.name||"video",t=e.video.constraints):n=e.video,e.audio&&(r=e.audio.constraints),n){case"both":case"send_only":case!0:return this.rtcHelper.getUserVideo(t,r).then(t=>{return this._handleVideoSend(t,"send_only"===n,"video",i,e)});case"receive_only":return this.log.debug("video - receive_only not implemented yet"),Promise.reject(new d("Not implemented yet"));case"none":break;default:if(!1===n){let e=this._findRtcObjectByType("video");if(e)return this._disableLeg(e.id)}break}}else Promise.resolve()}).then(()=>{if(e.screenshare){let t=!1,r="screenshare",n=["screen","window","tab"];switch(e.screenshare===Object(e.screenshare)?(t=e.screenshare.direction,r=e.screenshare.name||"screenshare",n=e.screenshare.sources||n):t=e.screenshare,t){case"send_only":case!0:return this.rtcHelper.getUserScreen(n).then(t=>{return this._handleVideoSend(t,!0,"screenshare",r,e)});case"none":break;default:if(!1===t){let e=this._findRtcObjectByType("screenshare");if(e)return this._disableLeg(e.id)}break}}else Promise.resolve()})}_emitEventsByRtcId(e){this.eventsQueue.filter(t=>t.id===e).forEach(e=>{e.func(),e.ran=!0}),this.eventsQueue=this.eventsQueue.filter(e=>!1===e.ran)}_runWhenLegInitialized(e,t){this.parentConversation.rtcObjects[e]?t():this.eventsQueue.push({id:e,func:t,ran:!1})}_handleVideoSend(e,t,r,n,i){const o=c.allocateUUID(),s=this.rtcHelper.createRTCPeerConnection({iceServers:this.application.session.config.iceServers,iceTransportPolicy:"all",bundlePolicy:"balanced",rtcpMuxPolicy:"require",iceCandidatePoolSize:"0"},{optional:[{DtlsSrtpKeyAgreement:"true"}]},o);s.trace("conversation_id",this.parentConversation.id),s.trace("member_id",this.parentConversation.me.id),this.listeningToRtcEvent||this.parentConversation.on("rtc:answer","media_module",e=>{let t=()=>{this.parentConversation.rtcObjects[e.body.rtc_id].pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e.body.answer})).then(()=>{this.log.debug("remote description is set")}).catch(e=>{this.log.warn("set remote description failed with error",e)})};this._runWhenLegInitialized(e.body.rtc_id,t)}),t||this.listeningToRtcEvent||(this.parentConversation.on("rtc:offer","media_module",e=>{let t=()=>{this._handleNewOffer(i,e)};this._runWhenLegInitialized(e.body.leg_id,t)}),this.parentConversation.on("rtc:terminate","media_module",e=>{this._handleParticipantRtcTerminate(e)}),this.parentConversation.on("member:left","media_module",e=>{this._handleMemberLeft(e)})),this.listeningToRtcEvent=!0,s.ontrack=(e=>{this.log.debug("ontrack"),this.application.activeStreams.push(e.streams[0])}),s.addStream(e);let a=this.streamIndex;this.streamIndex++;const p=new Promise((o,c)=>{s.createOffer().then(e=>{return s.setLocalDescription(e)}).then(()=>{const p=t?"send_only":"both",u={type:"rtc:new",cid:this.parentConversation.id,from:this.parentConversation.me.id,body:{offer:{sdp:s.localDescription.sdp},video:{direction:p,name:n}}};i&&i.label&&(u.label=i.label),this.application.session.sendRequest(u,t=>{if("rtc:new:success"===t.type){const n=t.body.rtc_id;this.parentConversation.rtcObjects[n]={id:n,pc:s,localStream:e,type:r,streamIndex:a},this._emitEventsByRtcId(n),s.trace("rtc_id",n),"screenshare"===r&&(e.getVideoTracks()[0].onended=(()=>{this._disableLeg(n).then(()=>{this.parentConversation.me.emit("media:stream:off",a)}).catch(()=>{this.parentConversation.me.emit("media:stream:off",a)})})),o(n)}else c(new d(t))})}).catch(e=>{c(new d(e))})});this.rtcNewPromises.push(p),this.parentConversation.me.emit("media:stream:on",{type:r,name:n,index:a,localStream:e});const u=[];return s.onicecandidate=(e=>{p.then(t=>{const r={};this._onIceCandidate(u,e,r,t)})}),s.oniceconnectionstatechange=(e=>{switch(s.iceConnectionState){case"disconnected":this.log.warn("One or more transports is disconnected",s.iceConnectionState);break;case"failed":this.log.warn("One or more transports has terminated unexpectedly or in an error",e);break;default:this.log.debug("The ice connection status changed",s.iceConnectionState);break}}),s.onicegatheringstatechange=(()=>{switch(s.iceGatheringState){case"new":this.log.debug("ice gathering new");break;case"complete":this.log.debug("ice gathering complete");break;case"gathering":this.log.debug("ice gathering gathering");break}}),this.parentConversation.on("member:left","media_module",e=>{e.user.id===this.application.me.id&&this.disable()}),this.log.debug("sending local stream"),p}_sendIceRequest(e,t){return new Promise((r,n)=>{const i={type:"rtc:ice",cid:this.parentConversation.id,from:this.parentConversation.me.id,rtc_id:t,body:e};this.application.session.sendRequest(i,e=>{"rtc:ice:success"===e.type?r():n(new d(e))})})}_onIceCandidate(e,t,r,n){const i=r;if(!t.candidate)return i.candidates={completed:!0},Promise.all(e).then(this._sendIceRequest(i,n)).then(()=>{this.log.debug("successfully sent trickle candidates",i)}).catch(()=>{this.log.error("failed to sent trickle candidates",i)});i.candidates=t.candidate,this.log.debug("sending trickle candidates: ",i),e.push(this._sendIceRequest(i,n))}_handleNewOffer(e,t){const r={remote_member_id:t.body.member_id,remote_leg_id:t.body.member_leg_id,local_leg_id:t.body.leg_id,name:t.body.name,streamIndex:this.streamIndex};this.streamIndex++;const n=!(!t.body.media_settings||!t.body.media_settings.video)&&t.body.media_settings.video.muted,i=!(!t.body.media_settings||!t.body.media_settings.audio)&&t.body.media_settings.audio.muted;for(let c in this.parentConversation.members)c===t.body.member_id&&(r.remote_member=this.parentConversation.members[c]);this.parentConversation.remoteMembers.push(r),this.log.debug("handle rtc:offer for member "+r.remote_member_id);const o=c.allocateUUID();r.pc=this.rtcHelper.createRTCPeerConnection({iceServers:this.application.session.config.iceServers,iceTransportPolicy:"all",bundlePolicy:"balanced",rtcpMuxPolicy:"require",iceCandidatePoolSize:"0"},{optional:[{DtlsSrtpKeyAgreement:"true"}]},o),r.pc.trace("conversation_id",this.parentConversation.id),r.pc.trace("member_id",this.parentConversation.me.id),r.pc.trace("rtc_id",r.local_leg_id),r.pc.trace("other_member_id",r.remote_member_id),r.pc.ontrack=(e=>{r.stream!==e.streams[0]&&(r.stream=e.streams[0],r.remote_member.emit("media:stream:on",{index:r.streamIndex,remote_member_id:r.remote_member_id,name:r.name,stream:r.stream,video_mute:n,audio_mute:i}))});let s=Promise.resolve();const a=[];r.pc.onicecandidate=(e=>{s=s.then(()=>{const t={other_member_id:r.remote_member_id,leg_id:r.remote_leg_id};this._onIceCandidate(a,e,t,r.local_leg_id)})}),r.pc.oniceconnectionstatechange=(e=>{switch(r.pc.iceConnectionState){case"disconnected":this.log.warn("One or more transports is disconnected",r.pc.iceConnectionState);break;case"failed":this.log.warn("transports has terminated or failed for member "+t.body.member_id,e);break;default:this.log.debug("The ice connection status changed for member "+t.body.member_id,r.pc.iceConnectionState);break}}),r.pc.onicegatheringstatechange=(()=>{switch(r.pc.iceGatheringState){case"new":this.log.debug("ice gathering new for member "+t.body.member_id);break;case"complete":this.log.debug("ice gathering complete for member "+t.body.member_id);break;case"gathering":this.log.debug("ice gathering gathering for member "+t.body.member_id);break}});const d=()=>{r.pc.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:t.body.sdp})).then(()=>{return r.pc.createAnswer()}).then(e=>{return r.pc.setLocalDescription(e)}).then(()=>{const t={type:"rtc:answer",cid:this.parentConversation.id,rtc_id:r.local_leg_id,from:this.parentConversation.me.id,body:{other_member_id:r.remote_member_id,answer:r.pc.localDescription.sdp,leg_id:r.remote_leg_id}};e&&e.label&&(t.label=e.label),this.application.session.sendRequest(t,e=>{"rtc:answer:success"===e.type?this.log.debug("successfully set answer for member "+r.remote_member_id):this.log.error(e.type+": failed to set answer for member "+r.remote_member_id)})})};this._runWhenLegInitialized(r.local_leg_id,d)}_handleMemberLeft(e){const t=e.id,r=this.parentConversation.remoteMembers.filter(e=>{return e.remote_member_id===t});r.forEach(e=>{this._handleParticipantRtcTerminate({body:{rtc_id:e.remote_leg_id}})})}_handleParticipantRtcTerminate(e){const t=this.parentConversation.remoteMembers.find(t=>{return t.remote_leg_id===e.body.rtc_id});t?(this.parentConversation.remoteMembers=this.parentConversation.remoteMembers.filter(t=>{return t.remote_leg_id!==e.body.rtc_id}),this._deleteMemberMedia(t),t.remote_member.emit("media:stream:off",{remote_member_id:t.remote_member_id,index:t.streamIndex})):this.log.error("rtc:terminate was sent with invalid member id")}_deleteMemberMedia(e){this._closeStream(e.stream),e.pc.close()}_findRtcObjectByType(e){return Object.values(this.parentConversation.rtcObjects).find(t=>t.type===e)}update(e){return new Promise((t,r)=>{this._validateUpdateParams(e).then(()=>{if(e.video){const t=this._findRtcObjectByType("video");if(t&&e.video.direction||!t&&!e.video.direction)return r(new p("error:media:update:invalid"))}else if(e.screenshare){const t=this._findRtcObjectByType("screenshare");if(t&&e.screenshare.direction||!t&&!e.screenshare.direction)return r(new p("error:media:update:invalid"))}return this._handleVideo(e).then(t).catch(r)}).catch(e=>r(e))})}_validateUpdateParams(e){return new Promise((t,r)=>{return e&&(e.video||e.screenshare)?e.video&&e.screenshare?r(new p("error:media:update:streams")):void t():r(new p("error:media:update:unsupported"))})}_closeStream(e){e.getTracks().forEach(e=>{e.stop()})}_disableActiveStream(){return this.application.activeStream&&this.application.activeStream.rtc_id?new Promise((e,t)=>{this.application.session.sendRequest({type:"rtc:terminate",cid:this.parentConversation.id,from:this.parentConversation.me.id,rtc_id:this.application.activeStream.rtc_id},r=>{"rtc:terminate:success"===r.type?e(r.type):t(new d(r))})}):Promise.resolve()}_cleanConversationProperties(){return Promise.resolve().then(()=>{this.parentConversation.pc&&this.parentConversation.pc.close(),this.parentConversation.remoteMembers&&this.parentConversation.remoteMembers.forEach(e=>{e.remote_member.emit("media:stream:off",{remote_member_id:e.remote_member_id,index:e.streamIndex}),this._deleteMemberMedia(e)}),this.application.localStream&&this._closeStream(this.application.localStream),this.application.activeStream&&this.application.activeStream.stream&&this._closeStream(this.application.activeStream.stream),this.parentConversation.localStream&&this._closeStream(this.parentConversation.localStream),delete this.parentConversation.pc,delete this.parentConversation.localStream,this.application.activeStream={},this.parentConversation.remoteMembers=[],this.parentConversation.releaseGroup("media_module")})}_disableLeg(e){const t=new Promise((t,r)=>{this.application.session.sendRequest({type:"rtc:terminate",cid:this.parentConversation.id,from:this.parentConversation.me.id,rtc_id:e},e=>{"rtc:terminate:success"===e.type?t(e.type):r(new d(e))})}),r=Promise.resolve().then(()=>{this.parentConversation.rtcObjects[e].pc&&this.parentConversation.rtcObjects[e].pc.close(),this.parentConversation.rtcObjects[e].localStream&&this._closeStream(this.parentConversation.rtcObjects[e].localStream)});return Promise.all([t,r]).then(()=>{return this.parentConversation.me.emit("media:stream:off",this.parentConversation.rtcObjects[e].streamIndex),delete this.parentConversation.rtcObjects[e],Promise.resolve("rtc:terminate:success")}).catch(e=>{return Promise.reject(e)})}_sendMuteRequest(e,t,r){let n={rtc_id:e},i={type:t,cid:this.parentConversation.id,to:this.parentConversation.me.id,from:this.parentConversation.me.id,body:n};this.application.session.sendRequest(i,r)}_enableMediaTracks(e,t){e.forEach(e=>{e.enabled=t})}_setMediaTracksAndMute(e,t,r,n,i){return this._enableMediaTracks(t,!r),new Promise((o,s)=>{this._sendMuteRequest(e,n,e=>{e.type===i?o(e.body):(this._enableMediaTracks(t,r),s(new d(e)))})})}_waitAllRtcNewAreCompleted(){return Promise.all(this.rtcNewPromises).catch(()=>{this.log.warn("Some of the enable requests failed.")})}mute(e=!1,t=!0,r=!1,n=0){const i=e?"on":"off",o="audio:mute:"+i,s="video:mute:"+i,a=o+":success",c=s+":success";return this._waitAllRtcNewAreCompleted().then(()=>{const i=Object.values(this.parentConversation.rtcObjects).find(e=>e.streamIndex===n);if(!i)throw new p("error:media:stream:not-found");let d=[];if(t){const t=i.localStream.getAudioTracks(),r=this._setMediaTracksAndMute(i.id,t,e,o,a);d.push(r)}if(r){const t=i.localStream.getVideoTracks(),r=this._setMediaTracksAndMute(i.id,t,e,s,c);d.push(r)}return Promise.all(d)})}earmuff(e){return new Promise((t,r)=>{if(null===this.me)r(new p("error:self"));else{let n="audio:earmuff:off";e&&(n="audio:earmuff:on"),this.application.session.sendRequest({type:n,cid:this.parentConversation.id,to:this.parentConversation.me.id},n=>{const i=e?"on":"off";n.type==="audio:earmuff:"+i+":success"?t(n.body):r(new d(n))})}})}enable(e){return new Promise((t,r)=>{const n=e=>{this.log.error(e),r(new p(e))};if(null!==this.parentConversation.me)return e&&this.parentConversation.is_video_conversation?this._handleVideo(e).catch(r).then(()=>{const n=["video","screenshare"];let i=[];return n.forEach(t=>{if(!e[t]){let e=this._findRtcObjectByType(t);e&&i.push(this._disableLeg(e.id))}}),Promise.all(i).then(t).catch(r)}):this.application.activeStream.rtc_id?n(new p("error:media:already-connecting")):(this.rtcstats_events&&this._initStatsEvents(),this._handleAudio(e).then(e=>t(e)).catch(e=>r(e)));r(new p("error:self"))})}_handleAudio(e){const t=new Promise((t,r)=>{const n=e=>{this.log.error(e),r(new p(e))},i=this.streamIndex;this.streamIndex++,this.rtcHelper.getUserAudio().then(o=>{if(this.application.activeStream.rtc_id)return n(new p("error:media:already-connecting"));const s=c.allocateUUID(),a={iceTransportPolicy:"all",bundlePolicy:"balanced",rtcpMuxPolicy:"require",iceCandidatePoolSize:"0"};this.application.session.config.iceServers&&(a.iceServers=this.application.session.config.iceServers);const u=this.rtcHelper.createRTCPeerConnection(a,{optional:[{DtlsSrtpKeyAgreement:"true"}]},s);u.trace("conversation_id",this.parentConversation.id),u.trace("member_id",this.parentConversation.me.id),this.parentConversation.pc=u,this.application.activeStream.pc=u,this.parentConversation.localStream=o,u.ontrack=(e=>{this.application.activeStream.stream=e.streams[0],t(e.streams[0])}),u.addStream(o),u.onnegotiationneeded=(()=>{u.createOffer().then(e=>{return u.setLocalDescription(e)}).then(()=>{}).catch(n)}),u.oniceconnectionstatechange=(e=>{switch(u.iceConnectionState){case"disconnected":this.log.warn("One or more transports is disconnected",u.iceConnectionState);break;case"failed":n(e),this.log.warn("One or more transports has terminated unexpectedly or in an error",e);break;default:this.log.debug("The ice connection status changed",u.iceConnectionState);break}});let h=null,l=!1;u.onicegatheringstatechange=(()=>{const t=()=>{if(!this.parentConversation.pc)return;const t={type:"rtc:new",cid:this.parentConversation.id,from:this.parentConversation.me.id,body:{offer:this.parentConversation.pc.localDescription}};e&&e.label&&(t.label=e.label),this.application.session.sendRequest(t,e=>{if("rtc:new:success"===e.type){const t=e.body.rtc_id;this.application.activeStream.rtc_id=t,u.trace("rtc_id",t),this.parentConversation.rtcObjects[t]={id:t,pc:u,localStream:o,streamIndex:i}}else r(new d(e))})};switch(u.iceGatheringState){case"new":this.log.debug("ice gathering new");break;case"complete":window.clearTimeout(h),h=null,l||t(),this.log.debug("ice gathering complete");break;case"gathering":h=setTimeout(()=>{t(),l=!0},2e3),this.log.debug("ice gathering gathering");break}})}).then(()=>{this.parentConversation.once("rtc:answer","media_module",e=>{if(this.application.activeStream.rtc_id){if(this.application.activeStream.rtc_id!==e.body.rtc_id)return void this.log.warn("RTC: skipping  rtc answer for different rtc_id")}else this.log.warn("RTC: rtc:new hasn't been resolved yet");this.parentConversation.pc?this.parentConversation.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e.body.answer}),()=>{this.log.debug("remote description is set")},n):this.log.warn("RTC: received an answer too late")}),this.parentConversation.on("member:left","media_module",e=>{e.user.id===this.application.me.id&&this.application.activeStream&&this.disable()})}).catch(e=>{r(new p(e))})});return this.rtcNewPromises.push(t),t}disable(){this.rtcStats&&this.rtcStats.disable();let e=[];e.push(this._disableActiveStream()),e.push(this._cleanConversationProperties());for(const t in this.parentConversation.rtcObjects)e.push(this._disableLeg(t));return Promise.all(e)}sayText(e){return new Promise((t,r)=>{const n={type:"audio:say",cid:this.parentConversation.id,body:{text:e.text,voice_name:e.voice_name||"Amy",level:e.level||1,queue:e.queue||!0,loop:e.loop||1,ssml:e.ssml||!1}};this.application.session.sendRequest(n,e=>{"audio:say:success"===e.type?(n.id=e.body.id,t(new Event(this.parentConversation,e))):r(new d(e))})})}record(e){return new Promise((t,r)=>{const n={type:"audio:record",cid:this.id,body:{format:e.format,destination_url:e.destination_url,streamed:e.streamed,validity_time:e.validity_time,beep_start:e.beep_start,beep_stop:e.beep_stop,detect_speech:e.detect_speech}};this.application.session.sendRequest(n,e=>{"audio:record:success"===e.type?(n.id=e.body.id,t(new Recording(this.parentConversation,e))):r(new d(e))})})}fetchRecording(e){return new Promise((t,r)=>{if(localStorage.getItem("NXMO_user_data")){const n=new XMLHttpRequest,i=JSON.parse(localStorage.getItem("NXMO_user_data")).token;n.open("GET",e),n.setRequestHeader("Authorization","Bearer "+i),n.setRequestHeader("Content-Type","application/json"),n.responseType="blob",n.onload=(()=>{if(4===n.readyState&&200===n.status){const e=new Blob([n.response],{type:"audio/ogg"});t(URL.createObjectUrl(e))}else r(new p("error:fetch-recording"))}),n.send()}else r(new p("error:user:relogin"))})}playStream(e){return new Promise((t,r)=>{const n={type:"audio:play",cid:this.parentConversation.id,body:e};this.application.session.sendRequest(n,e=>{"audio:play:success"===e.type?(n.id=e.body.id,t(new Event(this.parentConversation,e))):r(new d(e))})})}startRinging(){return new Promise((e,t)=>{const r={type:"audio:ringing:start",cid:this.parentConversation.id,from:this.parentConversation.me.id,body:{}};this.application.session.sendRequest(r,r=>{"audio:ringing:start:success"===r.type?e(new Event(this.parentConversation,r)):t(new d(r))})})}stopRinging(){return new Promise((e,t)=>{const r={type:"audio:ringing:stop",cid:this.parentConversation.id,from:this.parentConversation.me.id,body:{}};this.application.session.sendRequest(r,r=>{"audio:ringing:stop:success"===r.type?e(new Event(this.parentConversation,r)):t(new d(r))})})}}e.exports=u},9121:function(e,t){function r(e,t){var r=[];t=t||0;for(var n=t||0;n<e.length;n++)r[n-t]=e[n];return r}e.exports=r},9152:function(e,t){t.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,c=(1<<a)-1,d=c>>1,p=-7,u=r?i-1:0,h=r?-1:1,l=e[t+u];for(u+=h,o=l&(1<<-p)-1,l>>=-p,p+=a;p>0;o=256*o+e[t+u],u+=h,p-=8);for(s=o&(1<<-p)-1,o>>=-p,p+=n;p>0;s=256*s+e[t+u],u+=h,p-=8);if(0===o)o=1-d;else{if(o===c)return s?NaN:1/0*(l?-1:1);s+=Math.pow(2,n),o-=d}return(l?-1:1)*s*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var s,a,c,d=8*o-i-1,p=(1<<d)-1,u=p>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,l=n?0:o-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=p):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),t+=s+u>=1?h/c:h*Math.pow(2,1-u),t*c>=2&&(s++,c/=2),s+u>=p?(a=0,s=p):s+u>=1?(a=(t*c-1)*Math.pow(2,i),s+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,i),s=0));i>=8;e[r+l]=255&a,l+=f,a/=256,i-=8);for(s=s<<i|a,d+=i;d>0;e[r+l]=255&s,l+=f,s/=256,d-=8);e[r+l-f]|=128*m}},"94ac":function(e,t,r){e.exports=r("da92"),e.exports.parser=r("5a6e")},"955b":function(e,t,r){"use strict";var n=!0,i=!0;function o(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function s(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=r(e);t&&n(t)};return this._eventMap=this._eventMap||{},this._eventMap[n]=o,i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}e.exports={extractVersion:o,wrapPeerConnectionEvent:s,disableLog:function(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"===typeof window){if(n)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,r={browser:null,version:null};if("undefined"===typeof e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=o(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)r.browser="chrome",r.version=o(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=o(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=o(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r}}},"96fe":function(e,t,r){function n(e){var r,n=0;for(r in e)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]}function i(e){var r;function i(){if(i.enabled){var e=i,n=+new Date,o=n-(r||n);e.diff=o,e.prev=r,e.curr=n,r=n;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!==typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(r,n){if("%%"===r)return r;c++;var i=t.formatters[n];if("function"===typeof i){var o=s[c];r=i.call(e,o),s.splice(c,1),c--}return r}),t.formatArgs.call(e,s);var d=i.log||t.log||console.log.bind(console);d.apply(e,s)}}return i.namespace=e,i.enabled=t.enabled(e),i.useColors=t.useColors(),i.color=n(e),i.destroy=o,"function"===typeof t.init&&t.init(i),t.instances.push(i),i}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}function s(e){var r;t.save(e),t.names=[],t.skips=[];var n=("string"===typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&(e=n[r].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(r=0;r<t.instances.length;r++){var o=t.instances[r];o.enabled=t.enabled(o.namespace)}}function a(){t.enable("")}function c(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1}function d(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=i.debug=i["default"]=i,t.coerce=d,t.disable=a,t.enable=s,t.enabled=c,t.humanize=r("1468"),t.instances=[],t.names=[],t.skips=[],t.formatters={}},"9fca":function(e,t,r){const n=r("a7b3"),i=r("3396"),o=r("5c7d"),s=i.NexmoApiError,a=i.NexmoClientError;class c{constructor(e,t,r){this.application=e,this.log=o.getLogger(this.constructor.name),this.from=r,this.conversation=null,this.CALL_STATUS={STARTED:"started",RINGING:"ringing",ANSWERED:"answered",COMPLETED:"completed",BUSY:"busy",TIMEOUT:"timeout",UNANSWERED:"unanswered",REJECTED:"rejected",FAILED:"failed"},this.CALL_DIRECTION={INBOUND:"inbound",OUTBOUND:"outbound"},Object.freeze(this.CALL_DIRECTION),this.MEMBER_CALL_STATES={RINGING:"ringing",HUNGUP:"hungup",ANSWERED:"answered",REJECTED:"rejected"},Object.freeze(this.MEMBER_CALL_STATES),this.STATUS_PERMITTED_FLOW=new Map([["STARTED",new Set([this.CALL_STATUS.RINGING,this.CALL_STATUS.ANSWERED,this.CALL_STATUS.FAILED,this.CALL_STATUS.TIMEOUT,this.CALL_STATUS.UNANSWERED,this.CALL_STATUS.REJECTED,this.CALL_STATUS.BUSY])],["RINGING",new Set([this.CALL_STATUS.ANSWERED,this.CALL_STATUS.FAILED,this.CALL_STATUS.TIMEOUT,this.CALL_STATUS.UNANSWERED,this.CALL_STATUS.REJECTED,this.CALL_STATUS.BUSY])],["ANSWERED",new Set([this.CALL_STATUS.COMPLETED,this.CALL_STATUS.FAILED])]]),Object.freeze(this.STATUS_PERMITTED_FLOW),this.status=null,this.direction=this.CALL_DIRECTION.INBOUND,this._setupConversationObject(t),n.mixin(c)}_enableStatsEvents(){if(this.application.session.config&&!this.application.session.config.rtcstats_events)return this.conversation.media._enableStatsEvents()}_attachCallListeners(){this.conversation.releaseGroup("call_module"),this.conversation.on("member:left","call_module",(e,t)=>{let r=null;r=e.timestamp.joined?this.MEMBER_CALL_STATES.HUNGUP:this.MEMBER_CALL_STATES.REJECTED,this.emit("member:call:state",e,r,t),this._hangUpIfAllLeft()}),this.conversation.on("member:joined","call_module",(e,t)=>{const r=this.MEMBER_CALL_STATES.ANSWERED;this.emit("member:call:state",e,r,t)}),this.conversation.on("member:invited","call_module",(e,t)=>{const r=this.MEMBER_CALL_STATES.RINGING;this.emit("member:call:state",e,r,t)}),this.conversation.on("member:media","call_module",(e,t)=>{this.application.calls&&this.application.calls.has(this.conversation.id)&&this.application.calls.get(this.conversation.id)._handleStatusChange(t)})}_isValidStatusTransition(e){if(!e)throw new a(`Provide the status to validate the transition from '${this.status}'`);if(!this.status)return!0;const t=this.status.toUpperCase();return!!this.STATUS_PERMITTED_FLOW.has(t)&&(this.status!==e&&this.STATUS_PERMITTED_FLOW.get(t).has(e))}_hangUpIfAllLeft(){if(!this.conversation.me||"LEFT"===this.conversation.me.state||Object.keys(this.conversation.members).length<=1)return Promise.resolve();for(const e in this.conversation.members){if(!this.conversation.members[e])continue;const t=this.conversation.members[e];if("LEFT"!==t.state&&this.conversation.me.user.id!==t.user.id)return Promise.resolve()}return this.hangUp()}_handleStatusChange(e){const t=!this.conversation||this.conversation.me.id===e.from,r=this.direction===this.CALL_DIRECTION.OUTBOUND,n={"member:joined":()=>{return e.body.channel&&e.body.channel.knocking_id?this.conversation.media.enable().then(e=>{return this.conversation.media.rtcHelper._playAudioStream(e),this._setStatusAndEmit(this.CALL_STATUS.STARTED),Promise.resolve()}).catch(e=>{return this._setStatusAndEmit(this.CALL_STATUS.FAILED),this.log.error(e),Promise.reject(e)}):Promise.resolve()},"member:invited":()=>{return null===e.body.invited_by&&e.body.user.media&&e.body.user.media.audio&&this._setStatusAndEmit(this.CALL_STATUS.STARTED),Promise.resolve()},"member:left":()=>{return this.status===this.CALL_STATUS.ANSWERED?(this._setStatusAndEmit(this.CALL_STATUS.COMPLETED),Promise.resolve()):t&&r||!t&&!r?(this._setStatusAndEmit(this.CALL_STATUS.UNANSWERED),Promise.resolve()):(this._setStatusAndEmit(this.CALL_STATUS.REJECTED),Promise.resolve())},"member:media":()=>{return this.status!==this.CALL_STATUS.ANSWERED&&e.body.audio&&(t&&r||this._setStatusAndEmit(this.CALL_STATUS.ANSWERED)),Promise.resolve()},"sip:ringing":()=>{return this.status!==this.CALL_STATUS.RINGING&&this._setStatusAndEmit(this.CALL_STATUS.RINGING),Promise.resolve()},"sip:hangup":()=>{switch(e.body.reason.sip_code){case 486:this._setStatusAndEmit(this.CALL_STATUS.BUSY);break;case 487:this._setStatusAndEmit(this.CALL_STATUS.TIMEOUT);break;case 403:this._setStatusAndEmit(this.CALL_STATUS.FAILED);break}return Promise.resolve()},"knocking:delete:success":()=>{return this._setStatusAndEmit(this.CALL_STATUS.UNANSWERED),Promise.resolve()}};if(n.hasOwnProperty(e.type))return n[e.type].call(this)}_setupConversationObject(e){e&&(this.conversation=e,e.me?(this.to=Object.assign({},e.members),this.from&&delete this.to[this.from.id]):this.log.debug("missing own member object iin conversation"),this._attachCallListeners())}_setFrom(e){this.from=e}_setStatusAndEmit(e){this._isValidStatusTransition(e)?(this.status=e,this.application.emit("call:status:changed",this)):this.log.warn(`status attempt switch from ${this.status} to ${e}`)}answer(){return this.conversation?this.conversation.join().then(()=>{return this.conversation.media.enable().then(this.conversation.media.rtcHelper._playAudioStream)}).catch(e=>{return this._setStatusAndEmit(this.CALL_STATUS.FAILED),this.log.error(e),Promise.reject(e)}):Promise.reject(new a("error:call:answer"))}createCall(e){return e&&Array.isArray(e)&&0!==e.length?this.application.newConversationAndJoin({display_name:"CALL_"+this.application.me.name+"_"+e.join("_").replace(" ","")}).then(t=>{this.from=t.me,this.successful_invited_members=[];const r=e.map(e=>{return t.inviteWithAudio({user_name:e}).then(e=>{return this.successful_invited_members.push(e),Promise.resolve(e)}).catch(e=>{return this.log.warn(e),Promise.resolve(e)})}),n=()=>{return this.successful_invited_members.length>0?t.media.enable({audio:{muted:!1,earmuffed:!1}}).then(e=>{return t.media.rtcHelper._playAudioStream(e),Promise.resolve(r)}):Promise.reject(r)};return Promise.all(r).then(()=>{return this._setupConversationObject(t),n()})}).catch(e=>{return this.log.warn(e),this._setStatusAndEmit(this.CALL_STATUS.FAILED),Promise.reject(e)}):Promise.reject(new a("error:application:call:params"))}createPhoneCall(e){return new Promise((t,r)=>{this.application.session.sendRequest({type:"knocking:new",body:{channel:{type:"app",from:{type:"app"},to:{type:"phone",number:e}}}},e=>{"knocking:new:success"===e.type?t(e):r(new s(e))})})}hangUp(){return this.conversation&&this.conversation.media.disable(),this.knocking_id?new Promise((e,t)=>{this.application.session.sendRequest({type:"knocking:delete",body:{knocking_id:this.knocking_id}},r=>{if("knocking:delete:success"===r.type){const t=this.application._call_draft_list.get(this.knocking_id);t._handleStatusChange(r),this.application._call_draft_list.delete(this.knocking_id),e(r)}else this.conversation?(this.conversation.leave().then(e).catch(t),this.log.warn(new s(r))):(this.log.warn("Problem cancelling the call: Knocking cancel failed and Conversation.leave not available"),e())})}):this.conversation.leave()}reject(){return this.conversation?this.conversation.leave():Promise.reject(new a("error:call:reject"))}}e.exports=c},a081:function(e,t,r){(function(e,n){var i;/*! https://mths.be/utf8js v2.1.2 by @mathias */(function(o){var s="object"==typeof t&&t,a=("object"==typeof e&&e&&e.exports,"object"==typeof n&&n);a.global!==a&&a.window;var c,d,p,u=String.fromCharCode;function h(e){var t,r,n=[],i=0,o=e.length;while(i<o)t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<o?(r=e.charCodeAt(i++),56320==(64512&r)?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--)):n.push(t);return n}function l(e){var t,r=e.length,n=-1,i="";while(++n<r)t=e[n],t>65535&&(t-=65536,i+=u(t>>>10&1023|55296),t=56320|1023&t),i+=u(t);return i}function f(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function m(e,t){return u(e>>t&63|128)}function v(e,t){if(0==(4294967168&e))return u(e);var r="";return 0==(4294965248&e)?r=u(e>>6&31|192):0==(4294901760&e)?(f(e,t)||(e=65533),r=u(e>>12&15|224),r+=m(e,6)):0==(4292870144&e)&&(r=u(e>>18&7|240),r+=m(e,12),r+=m(e,6)),r+=u(63&e|128),r}function g(e,t){t=t||{};var r,n=!1!==t.strict,i=h(e),o=i.length,s=-1,a="";while(++s<o)r=i[s],a+=v(r,n);return a}function y(){if(p>=d)throw Error("Invalid byte index");var e=255&c[p];if(p++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function b(e){var t,r,n,i,o;if(p>d)throw Error("Invalid byte index");if(p==d)return!1;if(t=255&c[p],p++,0==(128&t))return t;if(192==(224&t)){if(r=y(),o=(31&t)<<6|r,o>=128)return o;throw Error("Invalid continuation byte")}if(224==(240&t)){if(r=y(),n=y(),o=(15&t)<<12|r<<6|n,o>=2048)return f(o,e)?o:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(r=y(),n=y(),i=y(),o=(7&t)<<18|r<<12|n<<6|i,o>=65536&&o<=1114111))return o;throw Error("Invalid UTF-8 detected")}function w(e,t){t=t||{};var r=!1!==t.strict;c=h(e),d=c.length,p=0;var n,i=[];while(!1!==(n=b(r)))i.push(n);return l(i)}var C={version:"2.1.2",encode:g,decode:w};i=function(){return C}.call(t,r,t,e),void 0===i||(e.exports=i)})()}).call(this,r("62e4")(e),r("c8ba"))},a23b:function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},a4c8:function(e,t,r){const n=r("a7b3"),i=r("3396"),o=i.NexmoApiError,s=i.NexmoClientError;class a{constructor(e,t){if(this.conversation=e,t)for(const r in t)switch(r){case"type":this.type=t.type;break;case"cid":this.cid=t.cid;break;case"from":this.from=t.from;break;case"timestamp":this.timestamp=t.timestamp;break;case"id":this.id=t.id;break;case"state":this.state=t.state;break;case"index":this.index=t.index;break;case"body":this.body=t.body,this.body.user&&this.body.user.user_id&&(this.body.user.id=this.body.user.user_id,delete this.body.user.user_id);break}n.mixin(a)}del(e=this.id){return new Promise((t,r)=>{this.conversation.application.session.sendRequest({type:"event:delete",cid:this.conversation.id,from:this.conversation.me.id,body:{event_id:e}},e=>{"event:delete:success"===e.type?t():r(new o(e))})})}delivered(e=this.id){return"text"!==this.type&&"image"!==this.type&&(this.type="event"),new Promise((t,r)=>{if(this.conversation.me.id===this.from)r(new s("error:delivered:own-message"));else if(this.state&&this.state.delivered_to&&this.state.delivered_to[this.conversation.me.id])r(new s("error:already-delivered"));else{const n={event_id:e};this.conversation.application.session.sendRequest({type:this.type+":delivered",from:this.conversation.me.id,cid:this.conversation.id,body:n},e=>{e.type===this.type+":delivered:success"?t():r(new o(e))}),t()}})}seen(e=this.id){return"text"!==this.type&&"image"!==this.type&&(this.type="event"),new Promise((t,r)=>{if(this.conversation.me.id===this.from)r(new s("error:seen:own-message"));else if(this.state&&this.state.seen_by&&this.state.seen_by[this.conversation.me.id])r(new s("error:already-seen"));else{const n={event_id:e};this.conversation.application.session.sendRequest({type:this.type+":seen",from:this.conversation.me.id,cid:this.conversation.id,body:n},e=>{e.type===this.type+":seen:success"?t():r(new o(e))})}})}}e.exports=a},a578:function(e,t,r){"use strict";var n=r("955b"),i=n.log;e.exports=function(e){var t=n.detectBrowser(e),r=e&&e.navigator,o=e&&e.MediaStreamTrack,s=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},a=function(e,n,o){var a=function(e){if("object"!==typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n=e[r]="object"===typeof e[r]?e[r]:{ideal:e[r]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||t.push(r),void 0!==n.exact&&("number"===typeof n.exact?n.min=n.max=n.exact:e[r]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var i={};"number"===typeof n.ideal?i[r]={min:n.ideal,max:n.ideal}:i[r]=n.ideal,e.advanced.push(i),delete n.ideal,Object.keys(n).length||delete e[r]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=a(e.audio)),e.video&&(e.video=a(e.video)),i("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,n,function(e){o(s(e))})},c=function(e){return new Promise(function(t,r){a(e,t,r)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},t.version<41){var d=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return d().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var p=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return p(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(s(e))})}}if(!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var u=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===typeof e&&"object"===typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),u(e.audio,"autoGainControl","mozAutoGainControl"),u(e.audio,"noiseSuppression","mozNoiseSuppression")),h(e)},o&&o.prototype.getSettings){var l=o.prototype.getSettings;o.prototype.getSettings=function(){var e=l.apply(this,arguments);return u(e,"mozAutoGainControl","autoGainControl"),u(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var f=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===typeof e&&(e=JSON.parse(JSON.stringify(e)),u(e,"autoGainControl","mozAutoGainControl"),u(e,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[e])}}}r.getUserMedia=function(e,i,o){if(t.version<44)return a(e,i,o);n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(i,o)}}},a7b3:function(e,t){function r(){}e.exports=r,r.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,r){this.callbacks=this.callbacks||{};var n=3===arguments.length,i=n?arguments[1]:void 0,o=n?arguments[2]:arguments[1];return o._groupName=i,(this.callbacks[e]=this.callbacks[e]||[]).push(o),this},t.once=function(e,t,r){var n=this,i=3===arguments.length,o=i?arguments[1]:void 0,s=i?arguments[2]:arguments[1];function a(){n.off(e,a),s.apply(this,arguments)}return this.on(e,o,a),this},t.releaseGroup=function(e){var t,r,n,i;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(i=this.callbacks[t],r=0,n=i.length;r<n;r++)i[r]._groupName===e&&(i.splice(r,1),r--,n--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var r,n=this.callbacks[e];return n?1===arguments.length?(delete this.callbacks[e],this):(r=n.indexOf(t),n.splice(r,1),0===n.length&&delete this.callbacks[e],this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,r,n,i=[].slice.call(arguments,1),o=this.callbacks[e],s=this.getWildcardCallbacks(e);if(o)for(n=o.slice(),t=0,r=n.length;t<r;++t){if(!n[t])break;n[t].apply(this,i)}if(s)for(r=s.length,n=s.slice(),t=0,r=n.length;t<r;++t){if(!n[t])break;n[t].apply(this,[e].concat(i))}return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,r,n=[];for(t in this.callbacks)r=t.split("*"),("*"===t||2===r.length&&e.slice(0,r[0].length)===r[0])&&(n=n.concat(this.callbacks[t]));return n}},r.mixin(r)},a899:function(e,t,r){const n=r("5c7d");class i{constructor(e){this.log=n.getLogger(this.constructor.name),this.application=e}_handleSipCallEvent(e){if(!this.application.calls.has(e.cid))return void this.log.warn("There is no call object for this Conversation id.");const t=this.application.calls.get(e.cid),r={"sip:hangup":()=>{t._handleStatusChange(e)},"sip:ringing":()=>{t._handleStatusChange(e)}};return r.hasOwnProperty(e.type)?r[e.type].call(this):void 0}}e.exports=i},b093:function(e,t,r){"use strict";var n=r("955b"),i=r("6536"),o=r("f03d");e.exports={shimGetUserMedia:r("5e64"),shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var s=o(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=i(e.iceServers)),new s(e)},e.RTCPeerConnection.prototype=s.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},b570:function(e,t,r){const n=r("5c7d"),i=r("a4c8"),o=r("6668"),s=r("5113"),a=r("cce5");class c{constructor(e,t){this.log=n.getLogger(this.constructor.name),this.application=e,this.conversation=t,this.constructed_event=null,this._handleEventMap={"audio:record":this._processAudioRecord,"audio:record:done":this._processAudioRecordDone,"event:delete":this._processDelete,image:this._processImage,"image:delivered":this._processDelivered,"image:seen":this._processSeen,"member:invited":this._processMember,"member:joined":this._processMember,"member:left":this._processMember,"member:media":this._processMedia,text:this._processText,"text:delivered":this._processDelivered,"text:seen":this._processSeen,"audio:mute:on":this._processMuteForMedia,"audio:mute:off":this._processMuteForMedia,"video:mute:on":this._processMuteForMedia,"video:mute:off":this._processMuteForMedia}}handleEvent(e){return this._handleEventMap.hasOwnProperty(e.type)&&this._handleEventMap[e.type].call(this,e)||new i(this.conversation,e)}_processAudioRecord(e){return new i(this.conversation,e)}_processAudioRecordDone(e){return new a(this.conversation,e)}_processDelivered(e){const t=e.body.event_id;if(this.conversation.events.has(t)){let r=this.conversation.events.get(t);return r.state=r.state||{},r.state.delivered_to=r.state.delivered_to||{},r.state.delivered_to[e.from]=e.timestamp,r}return this.log.warn("Event not found"),null}_processDelete(e){const t=this.conversation.events.get(e.body.event_id);return this.conversation.events.has(t.id)?(t.body.text&&(t.body.text=""),t.body.representations&&(t.body.representations=""),t.body.timestamp={deleted:e.timestamp},t):(this.log.warn("Event not found"),null)}_processImage(e){const t=new s(this.conversation,e);return this.conversation.me.id!==t.from&&t.delivered().catch(e=>{this.log.debug(e)}),t}_processMember(e){if(this.application.calls.has(this.conversation.id)){let t=this.application.calls.get(this.conversation.id);t._handleStatusChange(e)}return this.conversation.members[e.from]._handleEvent(e),new i(this.conversation,e)}_processMedia(e){return this.conversation.members[e.from]._handleEvent(e),null}_processMuteForMedia(e){if(this.conversation.rtcObjects[e.body.rtc_id])e.index=this.conversation.rtcObjects[e.body.rtc_id].streamIndex;else if(this.conversation.remoteMembers){const t=this.conversation.remoteMembers.find(t=>t.remote_leg_id===e.body.rtc_id);t&&(e.index=t.streamIndex)}return null}_processSeen(e){const t=e.body.event_id;if(this.conversation.events.has(t)){let r=this.conversation.events.get(t);return r.state=r.state||{},r.state.seen_by=r.state.seen_by||{},r.state.seen_by[e.from]=e.timestamp,r}return this.log.warn("Event not found"),null}_processText(e){const t=new o(this.conversation,e);return this.conversation.me.id!==t.from&&t.delivered().catch(e=>{this.log.debug(e)}),t}}e.exports=c},b639:function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=r("1fb5"),i=r("9152"),o=r("e3db");function s(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}function a(){return d.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function c(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return d.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=d.prototype):(null===e&&(e=new d(t)),e.length=t),e}function d(e,t,r){if(!d.TYPED_ARRAY_SUPPORT&&!(this instanceof d))return new d(e,t,r);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return p(this,e,t,r)}function p(e,t,r,n){if("number"===typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?v(e,t,r,n):"string"===typeof t?f(e,t,r):g(e,t)}function u(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t,r,n){return u(t),t<=0?c(e,t):void 0!==r?"string"===typeof n?c(e,t).fill(r,n):c(e,t).fill(r):c(e,t)}function l(e,t){if(u(t),e=c(e,t<0?0:0|y(t)),!d.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function f(e,t,r){if("string"===typeof r&&""!==r||(r="utf8"),!d.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|w(t,r);e=c(e,n);var i=e.write(t,r);return i!==n&&(e=e.slice(0,i)),e}function m(e,t){var r=t.length<0?0:0|y(t.length);e=c(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function v(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),d.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=d.prototype):e=m(e,t),e}function g(e,t){if(d.isBuffer(t)){var r=0|y(t.length);return e=c(e,r),0===e.length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||te(t.length)?c(e,0):m(e,t);if("Buffer"===t.type&&o(t.data))return m(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function y(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function b(e){return+e!=e&&(e=0),d.alloc(+e)}function w(e,t){if(d.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return K(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Z(e).length;default:if(n)return K(e).length;t=(""+t).toLowerCase(),n=!0}}function C(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,t>>>=0,r<=t)return"";e||(e="utf8");while(1)switch(e){case"hex":return j(this,t,r);case"utf8":case"utf-8":return L(this,t,r);case"ascii":return M(this,t,r);case"latin1":case"binary":return N(this,t,r);case"base64":return O(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function _(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function S(e,t,r,n,i){if(0===e.length)return-1;if("string"===typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"===typeof t&&(t=d.from(t,n)),d.isBuffer(t))return 0===t.length?-1:T(e,t,r,n,i);if("number"===typeof t)return t&=255,d.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):T(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function T(e,t,r,n,i){var o,s=1,a=e.length,c=t.length;if(void 0!==n&&(n=String(n).toLowerCase(),"ucs2"===n||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,r/=2}function d(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var p=-1;for(o=r;o<a;o++)if(d(e,o)===d(t,-1===p?0:o-p)){if(-1===p&&(p=o),o-p+1===c)return p*s}else-1!==p&&(o-=o-p),p=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){for(var u=!0,h=0;h<c;h++)if(d(e,o+h)!==d(t,h)){u=!1;break}if(u)return o}return-1}function E(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n),n>i&&(n=i)):n=i;var o=t.length;if(o%2!==0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function R(e,t,r,n){return ee(K(t,e.length-r),e,r,n)}function k(e,t,r,n){return ee($(t),e,r,n)}function P(e,t,r,n){return k(e,t,r,n)}function x(e,t,r,n){return ee(Z(t),e,r,n)}function A(e,t,r,n){return ee(Q(t,e.length-r),e,r,n)}function O(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function L(e,t,r){r=Math.min(e.length,r);var n=[],i=t;while(i<r){var o,s,a,c,d=e[i],p=null,u=d>239?4:d>223?3:d>191?2:1;if(i+u<=r)switch(u){case 1:d<128&&(p=d);break;case 2:o=e[i+1],128===(192&o)&&(c=(31&d)<<6|63&o,c>127&&(p=c));break;case 3:o=e[i+1],s=e[i+2],128===(192&o)&&128===(192&s)&&(c=(15&d)<<12|(63&o)<<6|63&s,c>2047&&(c<55296||c>57343)&&(p=c));break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128===(192&o)&&128===(192&s)&&128===(192&a)&&(c=(15&d)<<18|(63&o)<<12|(63&s)<<6|63&a,c>65535&&c<1114112&&(p=c))}null===p?(p=65533,u=1):p>65535&&(p-=65536,n.push(p>>>10&1023|55296),p=56320|1023&p),n.push(p),i+=u}return D(n)}t.Buffer=d,t.SlowBuffer=b,t.INSPECT_MAX_BYTES=50,d.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:s(),t.kMaxLength=a(),d.poolSize=8192,d._augment=function(e){return e.__proto__=d.prototype,e},d.from=function(e,t,r){return p(null,e,t,r)},d.TYPED_ARRAY_SUPPORT&&(d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0})),d.alloc=function(e,t,r){return h(null,e,t,r)},d.allocUnsafe=function(e){return l(null,e)},d.allocUnsafeSlow=function(e){return l(null,e)},d.isBuffer=function(e){return!(null==e||!e._isBuffer)},d.compare=function(e,t){if(!d.isBuffer(e)||!d.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},d.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return d.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=d.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(!d.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},d.byteLength=w,d.prototype._isBuffer=!0,d.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)_(this,t,t+1);return this},d.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)_(this,t,t+3),_(this,t+1,t+2);return this},d.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)_(this,t,t+7),_(this,t+1,t+6),_(this,t+2,t+5),_(this,t+3,t+4);return this},d.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?L(this,0,e):C.apply(this,arguments)},d.prototype.equals=function(e){if(!d.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===d.compare(this,e)},d.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},d.prototype.compare=function(e,t,r,n,i){if(!d.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var o=i-n,s=r-t,a=Math.min(o,s),c=this.slice(n,i),p=e.slice(t,r),u=0;u<a;++u)if(c[u]!==p[u]){o=c[u],s=p[u];break}return o<s?-1:s<o?1:0},d.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},d.prototype.indexOf=function(e,t,r){return S(this,e,t,r,!0)},d.prototype.lastIndexOf=function(e,t,r){return S(this,e,t,r,!1)},d.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"===typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return E(this,e,t,r);case"utf8":case"utf-8":return R(this,e,t,r);case"ascii":return k(this,e,t,r);case"latin1":case"binary":return P(this,e,t,r);case"base64":return x(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function D(e){var t=e.length;if(t<=I)return String.fromCharCode.apply(String,e);var r="",n=0;while(n<t)r+=String.fromCharCode.apply(String,e.slice(n,n+=I));return r}function M(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function N(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function j(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=X(e[o]);return i}function U(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function B(e,t,r){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function F(e,t,r,n,i,o){if(!d.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function q(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function W(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function G(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function z(e,t,r,n,o){return o||G(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),i.write(e,t,r,n,23,4),r+4}function H(e,t,r,n,o){return o||G(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),i.write(e,t,r,n,52,8),r+8}d.prototype.slice=function(e,t){var r,n=this.length;if(e=~~e,t=void 0===t?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e),d.TYPED_ARRAY_SUPPORT)r=this.subarray(e,t),r.__proto__=d.prototype;else{var i=t-e;r=new d(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},d.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||B(e,t,this.length);var n=this[e],i=1,o=0;while(++o<t&&(i*=256))n+=this[e+o]*i;return n},d.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||B(e,t,this.length);var n=this[e+--t],i=1;while(t>0&&(i*=256))n+=this[e+--t]*i;return n},d.prototype.readUInt8=function(e,t){return t||B(e,1,this.length),this[e]},d.prototype.readUInt16LE=function(e,t){return t||B(e,2,this.length),this[e]|this[e+1]<<8},d.prototype.readUInt16BE=function(e,t){return t||B(e,2,this.length),this[e]<<8|this[e+1]},d.prototype.readUInt32LE=function(e,t){return t||B(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},d.prototype.readUInt32BE=function(e,t){return t||B(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},d.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||B(e,t,this.length);var n=this[e],i=1,o=0;while(++o<t&&(i*=256))n+=this[e+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},d.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||B(e,t,this.length);var n=t,i=1,o=this[e+--n];while(n>0&&(i*=256))o+=this[e+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},d.prototype.readInt8=function(e,t){return t||B(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},d.prototype.readInt16LE=function(e,t){t||B(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},d.prototype.readInt16BE=function(e,t){t||B(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},d.prototype.readInt32LE=function(e,t){return t||B(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},d.prototype.readInt32BE=function(e,t){return t||B(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},d.prototype.readFloatLE=function(e,t){return t||B(e,4,this.length),i.read(this,e,!0,23,4)},d.prototype.readFloatBE=function(e,t){return t||B(e,4,this.length),i.read(this,e,!1,23,4)},d.prototype.readDoubleLE=function(e,t){return t||B(e,8,this.length),i.read(this,e,!0,52,8)},d.prototype.readDoubleBE=function(e,t){return t||B(e,8,this.length),i.read(this,e,!1,52,8)},d.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t|=0,r|=0,!n){var i=Math.pow(2,8*r)-1;F(this,e,t,r,i,0)}var o=1,s=0;this[t]=255&e;while(++s<r&&(o*=256))this[t+s]=e/o&255;return t+r},d.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t|=0,r|=0,!n){var i=Math.pow(2,8*r)-1;F(this,e,t,r,i,0)}var o=r-1,s=1;this[t+o]=255&e;while(--o>=0&&(s*=256))this[t+o]=e/s&255;return t+r},d.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,1,255,0),d.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},d.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):q(this,e,t,!0),t+2},d.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):q(this,e,t,!1),t+2},d.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):W(this,e,t,!0),t+4},d.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):W(this,e,t,!1),t+4},d.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);F(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;this[t]=255&e;while(++o<r&&(s*=256))e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},d.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);F(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;this[t+o]=255&e;while(--o>=0&&(s*=256))e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},d.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,1,127,-128),d.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},d.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):q(this,e,t,!0),t+2},d.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):q(this,e,t,!1),t+2},d.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):W(this,e,t,!0),t+4},d.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):W(this,e,t,!1),t+4},d.prototype.writeFloatLE=function(e,t,r){return z(this,e,t,!0,r)},d.prototype.writeFloatBE=function(e,t,r){return z(this,e,t,!1,r)},d.prototype.writeDoubleLE=function(e,t,r){return H(this,e,t,!0,r)},d.prototype.writeDoubleBE=function(e,t,r){return H(this,e,t,!1,r)},d.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!d.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},d.prototype.fill=function(e,t,r,n){if("string"===typeof e){if("string"===typeof t?(n=t,t=0,r=this.length):"string"===typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!==typeof n)throw new TypeError("encoding must be a string");if("string"===typeof n&&!d.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"===typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=d.isBuffer(e)?e:K(new d(e,n).toString()),a=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var J=/[^+\/0-9A-Za-z-_]/g;function Y(e){if(e=V(e).replace(J,""),e.length<2)return"";while(e.length%4!==0)e+="=";return e}function V(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function X(e){return e<16?"0"+e.toString(16):e.toString(16)}function K(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if(r=e.charCodeAt(s),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function $(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function Q(e,t){for(var r,n,i,o=[],s=0;s<e.length;++s){if((t-=2)<0)break;r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n)}return o}function Z(e){return n.toByteArray(Y(e))}function ee(e,t,r,n){for(var i=0;i<n;++i){if(i+r>=t.length||i>=e.length)break;t[i+r]=e[i]}return i}function te(e){return e!==e}}).call(this,r("c8ba"))},bf01:function(e,t,r){"use strict";var n=r("955b"),i=n.log;e.exports=function(e){var t=n.detectBrowser(e),r=e&&e.navigator,o=function(e){if("object"!==typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"===typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"===typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var o={};"number"===typeof n.ideal?(o[i("min",r)]=n.ideal,t.optional.push(o),o={},o[i("max",r)]=n.ideal,t.optional.push(o)):(o[i("",r)]=n.ideal,t.optional.push(o))}void 0!==n.exact&&"number"!==typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,n){if(t.version>=61)return n(e);if(e=JSON.parse(JSON.stringify(e)),e&&"object"===typeof e.audio){var s=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),s(e.audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"===typeof e.video){var a=e.video.facingMode;a=a&&("object"===typeof a?a:{ideal:a});var c,d=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||d))if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?c=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(c=["front"]),c)return r.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var r=t.find(function(e){return c.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!r&&t.length&&-1!==c.indexOf("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=a.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),n(e)});e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),n(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,t,n){s(e,function(e){r.webkitGetUserMedia(e,t,function(e){n&&n(a(e))})})};r.getUserMedia=c;var d=function(e){return new Promise(function(t,n){r.getUserMedia(e,t,n)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:d,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var p=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return s(e,function(e){return p(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(a(e))})})}}else r.mediaDevices.getUserMedia=function(e){return d(e)};"undefined"===typeof r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),"undefined"===typeof r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},c437:function(e,t,r){var n,i,o=r("e1f4"),s=r("2366"),a=0,c=0;function d(e,t,r){var d=t&&r||0,p=t||[];e=e||{};var u=e.node||n,h=void 0!==e.clockseq?e.clockseq:i;if(null==u||null==h){var l=o();null==u&&(u=n=[1|l[0],l[1],l[2],l[3],l[4],l[5]]),null==h&&(h=i=16383&(l[6]<<8|l[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:c+1,v=f-a+(m-c)/1e4;if(v<0&&void 0===e.clockseq&&(h=h+1&16383),(v<0||f>a)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,c=m,i=h,f+=122192928e5;var g=(1e4*(268435455&f)+m)%4294967296;p[d++]=g>>>24&255,p[d++]=g>>>16&255,p[d++]=g>>>8&255,p[d++]=255&g;var y=f/4294967296*1e4&268435455;p[d++]=y>>>8&255,p[d++]=255&y,p[d++]=y>>>24&15|16,p[d++]=y>>>16&255,p[d++]=h>>>8|128,p[d++]=255&h;for(var b=0;b<6;++b)p[d+b]=u[b];return t||s(p)}e.exports=d},c64e:function(e,t,r){var n=r("e1f4"),i=r("2366");function o(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),e=e||{};var s=e.random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||i(s)}e.exports=o},c9eb:function(e,t){try{e.exports="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},ca99:function(e,t){e.exports=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||0===n)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(r-t),s=t,a=0;s<r;s++,a++)o[a]=i[s];return o.buffer}},cc9e:function(e,t,r){(function(t){var n=r("5317"),i=r("34eb")("socket.io-client:url");function o(e,r){var o=e;r=r||t.location,null==e&&(e=r.protocol+"//"+r.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e="undefined"!==typeof r?r.protocol+"//"+e:"https://"+e),i("parse %s",e),o=n(e)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/";var s=-1!==o.host.indexOf(":"),a=s?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+a+":"+o.port,o.href=o.protocol+"://"+a+(r&&r.port===o.port?"":":"+o.port),o}e.exports=o}).call(this,r("c8ba"))},ccc1:function(e,t){function r(e,t,r){var i=!1;return r=r||n,o.count=e,0===e?t():o;function o(e,n){if(o.count<=0)throw new Error("after called too many times");--o.count,e?(i=!0,t(e),t=r):0!==o.count||i||t(null,n)}}function n(){}e.exports=r},cce5:function(e,t,r){const n=r("a4c8");class i extends n{constructor(e,t){super(e,t),this.conversation=e,Object.assign(this,t)}stop(){return super.del()}}e.exports=i},d093:function(e,t,r){"use strict";(function(t){var n=r("1808");e.exports=n({window:t.window})}).call(this,r("c8ba"))},d306:function(e,t,r){var n,i;(function(o,s){n=s,i="function"===typeof n?n.call(t,r,t,e):n,void 0===i||(e.exports=i)})(0,function(e){"use strict";var t,r,n=function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(t in arguments[r])Object.prototype.hasOwnProperty.call(arguments[r],t)&&(e[t]=arguments[r][t]);return e},i={template:"[%t] %l:",levelFormatter:function(e){return e.toUpperCase()},nameFormatter:function(e){return e||"root"},timestampFormatter:function(e){return e.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},o={},s=function(e){if(!e||!e.getLogger)throw new TypeError("Argument is not a root logger");t=e},a=function(e,r){if(!e||!e.setLevel)throw new TypeError("Argument is not a logger");var s=e.methodFactory,a=e.name||"",c=o[a]||o[""]||i;function d(e,t,r){var n=s(e,t,r),i=o[r]||o[""],c=-1!==i.template.indexOf("%t"),d=-1!==i.template.indexOf("%l"),p=-1!==i.template.indexOf("%n");return function(){for(var t="",s=arguments.length,u=Array(s),h=0;h<s;h++)u[h]=arguments[h];if(a||!o[r]){var l=i.timestampFormatter(new Date),f=i.levelFormatter(e),m=i.nameFormatter(r);i.format?t+=i.format(f,m,l):(t+=i.template,c&&(t=t.replace(/%t/,l)),d&&(t=t.replace(/%l/,f)),p&&(t=t.replace(/%n/,m))),u.length&&"string"===typeof u[0]?u[0]=t+" "+u[0]:u.unshift(t)}n.apply(void 0,u)}}return o[a]||(e.methodFactory=d),r=r||{},r.template&&(r.format=void 0),o[a]=n({},c,r),e.setLevel(e.getLevel()),t||e.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),e},c={reg:s,apply:a};return e&&(r=e.prefix,c.noConflict=function(){return e.prefix===c&&(e.prefix=r),c}),c})},d33e:function(e,t,r){(function(t){var n=r("01d3"),i=r("0949"),o=r("7297"),s=r("62fa"),a=r("34eb")("engine.io-client:polling-xhr");function c(){}function d(e){if(i.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,t.location){var r="https:"===location.protocol,n=location.port;n||(n=r?443:80),this.xd=e.hostname!==t.location.hostname||n!==e.port,this.xs=e.secure!==r}}function p(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function u(){for(var e in p.requests)p.requests.hasOwnProperty(e)&&p.requests[e].abort()}e.exports=d,e.exports.Request=p,s(d,i),d.prototype.supportsBinary=!0,d.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new p(e)},d.prototype.doWrite=function(e,t){var r="string"!==typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),i=this;n.on("success",t),n.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=n},d.prototype.doPoll=function(){a("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},o(p.prototype),p.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var r=this.xhr=new n(e),i=this;try{a("xhr open %s: %s",this.method,this.uri),r.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var o in r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&r.setRequestHeader(o,this.extraHeaders[o])}catch(e){}if("POST"===this.method)try{this.isBinary?r.setRequestHeader("Content-type","application/octet-stream"):r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{r.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in r&&(r.withCredentials=!0),this.requestTimeout&&(r.timeout=this.requestTimeout),this.hasXDR()?(r.onload=function(){i.onLoad()},r.onerror=function(){i.onError(r.responseText)}):r.onreadystatechange=function(){if(2===r.readyState)try{var e=r.getResponseHeader("Content-Type");i.supportsBinary&&"application/octet-stream"===e&&(r.responseType="arraybuffer")}catch(e){}4===r.readyState&&(200===r.status||1223===r.status?i.onLoad():setTimeout(function(){i.onError(r.status)},0))},a("xhr data %s",this.data),r.send(this.data)}catch(e){return void setTimeout(function(){i.onError(e)},0)}t.document&&(this.index=p.requestsCount++,p.requests[this.index]=this)},p.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},p.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},p.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},p.prototype.cleanup=function(e){if("undefined"!==typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,e)try{this.xhr.abort()}catch(e){}t.document&&delete p.requests[this.index],this.xhr=null}},p.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},p.prototype.hasXDR=function(){return"undefined"!==typeof t.XDomainRequest&&!this.xs&&this.enablesXDR},p.prototype.abort=function(){this.cleanup()},p.requestsCount=0,p.requests={},t.document&&(t.attachEvent?t.attachEvent("onunload",u):t.addEventListener&&t.addEventListener("beforeunload",u,!1))}).call(this,r("c8ba"))},d780:function(e,t,r){(function(t){var r=t.BlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder||t.MozBlobBuilder,n=function(){try{var e=new Blob(["hi"]);return 2===e.size}catch(e){return!1}}(),i=n&&function(){try{var e=new Blob([new Uint8Array([1,2])]);return 2===e.size}catch(e){return!1}}(),o=r&&r.prototype.append&&r.prototype.getBlob;function s(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.buffer instanceof ArrayBuffer){var n=r.buffer;if(r.byteLength!==n.byteLength){var i=new Uint8Array(r.byteLength);i.set(new Uint8Array(n,r.byteOffset,r.byteLength)),n=i.buffer}e[t]=n}}}function a(e,t){t=t||{};var n=new r;s(e);for(var i=0;i<e.length;i++)n.append(e[i]);return t.type?n.getBlob(t.type):n.getBlob()}function c(e,t){return s(e),new Blob(e,t||{})}e.exports=function(){return n?i?t.Blob:c:o?a:void 0}()}).call(this,r("c8ba"))},d838:function(e,t){function r(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}e.exports=r},da92:function(e,t,r){(function(t){var n=r("6a44"),i=r("7297"),o=r("34eb")("engine.io-client:socket"),s=r("ee34"),a=r("5a6e"),c=r("5317"),d=r("4f2a");function p(e,r){if(!(this instanceof p))return new p(e,r);r=r||{},e&&"object"===typeof e&&(r=e,e=null),e?(e=c(e),r.hostname=e.host,r.secure="https"===e.protocol||"wss"===e.protocol,r.port=e.port,e.query&&(r.query=e.query)):r.host&&(r.hostname=c(r.host).host),this.secure=null!=r.secure?r.secure:t.location&&"https:"===location.protocol,r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.agent=r.agent||!1,this.hostname=r.hostname||(t.location?location.hostname:"localhost"),this.port=r.port||(t.location&&location.port?location.port:this.secure?443:80),this.query=r.query||{},"string"===typeof this.query&&(this.query=d.decode(this.query)),this.upgrade=!1!==r.upgrade,this.path=(r.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!r.forceJSONP,this.jsonp=!1!==r.jsonp,this.forceBase64=!!r.forceBase64,this.enablesXDR=!!r.enablesXDR,this.timestampParam=r.timestampParam||"t",this.timestampRequests=r.timestampRequests,this.transports=r.transports||["polling","websocket"],this.transportOptions=r.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=r.policyPort||843,this.rememberUpgrade=r.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=r.onlyBinaryUpgrades,this.perMessageDeflate=!1!==r.perMessageDeflate&&(r.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=r.pfx||null,this.key=r.key||null,this.passphrase=r.passphrase||null,this.cert=r.cert||null,this.ca=r.ca||null,this.ciphers=r.ciphers||null,this.rejectUnauthorized=void 0===r.rejectUnauthorized||r.rejectUnauthorized,this.forceNode=!!r.forceNode;var n="object"===typeof t&&t;n.global===n&&(r.extraHeaders&&Object.keys(r.extraHeaders).length>0&&(this.extraHeaders=r.extraHeaders),r.localAddress&&(this.localAddress=r.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}function u(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}e.exports=p,p.priorWebsocketSuccess=!1,i(p.prototype),p.protocol=a.protocol,p.Socket=p,p.Transport=r("19b7"),p.transports=r("6a44"),p.parser=r("5a6e"),p.prototype.createTransport=function(e){o('creating transport "%s"',e);var t=u(this.query);t.EIO=a.protocol,t.transport=e;var r=this.transportOptions[e]||{};this.id&&(t.sid=this.id);var i=new n[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0});return i},p.prototype.open=function(){var e;if(this.rememberUpgrade&&p.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},p.prototype.setTransport=function(e){o("setting transport %s",e.name);var t=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},p.prototype.probe=function(e){o('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),r=!1,n=this;function i(){if(n.onlyBinaryUpgrades){var i=!this.supportsBinary&&n.transport.supportsBinary;r=r||i}r||(o('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(i){if(!r)if("pong"===i.type&&"probe"===i.data){if(o('probe transport "%s" pong',e),n.upgrading=!0,n.emit("upgrading",t),!t)return;p.priorWebsocketSuccess="websocket"===t.name,o('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){r||"closed"!==n.readyState&&(o("changing transport and sending upgrade packet"),h(),n.setTransport(t),t.send([{type:"upgrade"}]),n.emit("upgrade",t),t=null,n.upgrading=!1,n.flush())})}else{o('probe transport "%s" failed',e);var s=new Error("probe error");s.transport=t.name,n.emit("upgradeError",s)}}))}function s(){r||(r=!0,h(),t.close(),t=null)}function a(r){var i=new Error("probe error: "+r);i.transport=t.name,s(),o('probe transport "%s" failed because of error: %s',e,r),n.emit("upgradeError",i)}function c(){a("transport closed")}function d(){a("socket closed")}function u(e){t&&e.name!==t.name&&(o('"%s" works - aborting "%s"',e.name,t.name),s())}function h(){t.removeListener("open",i),t.removeListener("error",a),t.removeListener("close",c),n.removeListener("close",d),n.removeListener("upgrading",u)}p.priorWebsocketSuccess=!1,t.once("open",i),t.once("error",a),t.once("close",c),this.once("close",d),this.once("upgrading",u),t.open()},p.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",p.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},p.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(o('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data);break}else o('packet received with socket readyState "%s"',this.readyState)},p.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},p.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},p.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){o("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},p.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},p.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},p.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},p.prototype.write=p.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},p.prototype.sendPacket=function(e,t,r,n){if("function"===typeof t&&(n=t,t=void 0),"function"===typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){r=r||{},r.compress=!1!==r.compress;var i={type:e,data:t,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}},p.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():t()}):this.upgrading?n():t()}function t(){e.onClose("forced close"),o("socket closing - telling transport to close"),e.transport.close()}function r(){e.removeListener("upgrade",r),e.removeListener("upgradeError",r),t()}function n(){e.once("upgrade",r),e.once("upgradeError",r)}return this},p.prototype.onError=function(e){o("socket error %j",e),p.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},p.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){o('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),r.writeBuffer=[],r.prevBufferLen=0}},p.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~s(this.transports,e[r])&&t.push(e[r]);return t}}).call(this,r("c8ba"))},e1f4:function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);e.exports=function(){return r(n),n}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},e3db:function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},e476:function(e,t,r){const n=r("3396"),i="screenshare-extension-installed",o=n.NexmoClientError;class s{constructor(e){this.screenShareExtensionId=e}checkScreenShareInstalled(){return new Promise((e,t)=>{chrome.runtime.sendMessage(this.screenShareExtensionId,i,r=>{r&&"success"===r.type&&"0.1.0"===r.version?e():t(new o("error:media:extension-not-installed"))})})}getScreenShare(e){return new Promise((t,r)=>{chrome.runtime.sendMessage(this.screenShareExtensionId,{sources:e},e=>{e&&"error"!==e.type&&"success"===e.type?t(e.streamId):r(new o("error:media:extension"))})})}}e.exports=s},e578:function(e,t,r){(function(n){var i,o;(function(r,n){void 0===r&&void 0!==window&&(r=window),i=[],o=function(){return r["ConversationClient"]=n()}.apply(t,i),void 0===o||(e.exports=o)})(this,function(){"use strict";let e=n.ConversationClient||{};return e=r("74ba"),n.ConversationClient=e,e})}).call(this,r("c8ba"))},e795:function(e,t,r){const n=r("a7b3");class i{constructor(e,t){this.application=e,Object.assign(this,t),n.mixin(i)}}e.exports=i},e82e:function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},eac1:function(e,t,r){const n=r("5c7d"),i=r("3396").NexmoClientError;class o{constructor(e){if(this.log=n.getLogger(this.constructor.name),!e)throw new i("no emitter object passed for the Error Emitter");this.emitter=e,this.LISTENER_GROUP="Stitch-errors"}emitResponseIfError(e){if(this._isTypeError(e.type))return this.emitter.emit(e.type,this.LISTENER_GROUP,e)}cleanup(){return this.emitter.releaseGroup(this.LISTENER_GROUP)}_isTypeError(e){return-1!==e.indexOf("error")}}e.exports=o},ec44:function(e,t,r){r("d093");const n=r("4a35"),i=r("5c7d"),o=r("e476"),s=r("3396").NexmoClientError,a=n.detect();class c{constructor(){this.log=i.getLogger(this.constructor.name)}getUserAudio(){return navigator.mediaDevices.getUserMedia({video:!1,audio:!0})}getUserVideo(e=!0,t=!0){let r={video:e,audio:t};return navigator.mediaDevices.getUserMedia(r)}getUserScreen(e){return this.checkBrowserRunOnHttps().then(()=>{return this.checkChromeExtensionIsInstalled()}).then(()=>{return this.getShareScreenStream(e)})}createRTCPeerConnection(e,t,r){t.optional.push({clientId:r});const n=new RTCPeerConnection(e,t);return n.trace=(()=>{}),n}checkBrowserRunOnHttps(){return new Promise((e,t)=>{"https:"!==this._getWindowLocationProtocol()&&t(new s("error:media:unsupported-browser")),e()})}checkChromeExtensionIsInstalled(){return"chrome"===this._getBrowserName()?(this.chromeHelper||this._initChromeHelper(),this.chromeHelper.checkScreenShareInstalled()):Promise.resolve()}getShareScreenStream(e){switch(this._getBrowserName()){case"chrome":return this.chromeGetShareScreenStream(e);case"firefox":return this.fireFoxGetShareScreenStream();default:return Promise.reject(new s("error:media:unsupported-browser"))}}fireFoxGetShareScreenStream(){let e={video:{mozMediaSource:"screen",mediaSource:"screen"},audio:!1};return navigator.mediaDevices.getUserMedia(e)}chromeGetShareScreenStream(e){return this.chromeHelper||this._initChromeHelper(),this.chromeHelper.getScreenShare(e).then(e=>{const t={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:15,chromeMediaSourceId:e},optional:[]}};return navigator.mediaDevices.getUserMedia(t)})}firefoxGetShareScreenStream(){Promise.reject(new s("Not support"))}_playAudioStream(e){const t=new Audio;return t.srcObject=e,t.autoplay=!0,t}_getWindowLocationProtocol(){return window.location.protocol}_getBrowserName(){return a.name}_setScreenShareExtensionId(e){return"string"!==typeof e?Promise.reject(new s("not a valid extension id string")):(this.screenShareExtensionId=e,Promise.resolve())}_initChromeHelper(){return this.screenShareExtensionId?(this.chromeHelper=new o(this.screenShareExtensionId),Promise.resolve(this.chromeHelper)):Promise.reject(new s("screenShareExtensionId not set, set it with _setScreenShareExtensionId(screenShareExtensionId)"))}isNode(){return"node"===a.name}}e.exports=c},ee34:function(e,t){var r=[].indexOf;e.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},f03d:function(e,t,r){"use strict";var n=r("282b");function i(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}function o(e,t,r,i,o){var s=n.writeRtpDescription(e.kind,t);if(s+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":o||"active"),s+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(i?i.id:"-")+" "+a+"\r\n";s+="a="+c,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),s}function s(e,t){var r=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"===typeof n;return i&&(n=[n]),n=n.filter(function(e){var n=0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!r;return n?(r=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=i?n[0]:n,!!n.length}})}function a(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var o=n(e.parameters.apt,r),s=n(t.parameters.apt,i);return o&&s&&o.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(n){for(var o=0;o<t.codecs.length;o++){var s=t.codecs[o];if(n.name.toLowerCase()===s.name.toLowerCase()&&n.clockRate===s.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&s.parameters.apt&&!i(n,s,e.codecs,t.codecs))continue;s=JSON.parse(JSON.stringify(s)),s.numChannels=Math.min(n.numChannels,s.numChannels),r.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function c(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function d(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function p(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}e.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}function h(t,r,n,i){var o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var l=function(r){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw p("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all";break}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced";break}if(r.iceServers=s(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var a=r.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"===typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},l.prototype.addTrack=function(t,r){if(this._isClosed)throw p("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n,i=this.transceivers.find(function(e){return e.track===t});if(i)throw p("InvalidAccessError","Track already exists.");for(var o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(n=this.transceivers[o]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},l.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},l.prototype.removeTrack=function(t){if(this._isClosed)throw p("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw p("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null;var i=this.transceivers.map(function(e){return e.stream});-1===i.indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},l.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},l.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},l.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},l.prototype._gather=function(t,r){var i=this,o=this.transceivers[r].iceGatherer;if(!o.onlocalcandidate){var s=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:r};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),a.component=1,a.ufrag=o.getLocalParameters().usernameFragment;var d=n.writeCandidate(a);s.candidate=Object.assign(s.candidate,n.parseCandidate(d)),s.candidate.candidate=d,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var p=n.getMediaSections(i._localDescription.sdp);p[s.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",i._localDescription.sdp=n.getDescription(i._localDescription.sdp)+p.join("");var u=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",s),u&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){s.forEach(function(e){o.onlocalcandidate(e)})},0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,r,i){var o=a(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),i&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},l.prototype.setLocalDescription=function(e){var t,r,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(p("TypeError",'Unsupported type "'+e.type+'"'));if(!c("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(p("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=n.parseRtpParameters(e);i.transceivers[t].localCapabilities=r}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=n.splitSections(i._remoteDescription.sdp),r=t.shift();var o=n.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var s=i.transceivers[t],c=s.iceGatherer,d=s.iceTransport,p=s.dtlsTransport,u=s.localCapabilities,h=s.remoteCapabilities,l=n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length;if(!l&&!s.rejected){var f=n.getIceParameters(e,r),m=n.getDtlsParameters(e,r);o&&(m.role="server"),i.usingBundle&&0!==t||(i._gather(s.mid,t),"new"===d.state&&d.start(c,f,o?"controlling":"controlled"),"new"===p.state&&p.start(m));var v=a(u,h);i._transceive(s,v.codecs.length>0,!1)}})}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(i){var o=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(p("TypeError",'Unsupported type "'+i.type+'"'));if(!c("setRemoteDescription",i.type,o.signalingState)||o._isClosed)return Promise.reject(p("InvalidStateError","Can not set remote "+i.type+" in state "+o.signalingState));var s={};o.remoteStreams.forEach(function(e){s[e.id]=e});var a=[],l=n.splitSections(i.sdp),f=l.shift(),m=n.matchPrefix(f,"a=ice-lite").length>0,v=n.matchPrefix(f,"a=group:BUNDLE ").length>0;o.usingBundle=v;var g=n.matchPrefix(f,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!g&&g.substr(14).split(" ").indexOf("trickle")>=0,l.forEach(function(c,p){var h=n.splitLines(c),l=n.getKind(c),g=n.isRejected(c)&&0===n.matchPrefix(c,"a=bundle-only").length,y=h[0].substr(2).split(" ")[2],b=n.getDirection(c,f),w=n.parseMsid(c),C=n.getMid(c)||n.generateIdentifier();if(g||"application"===l&&("DTLS/SCTP"===y||"UDP/DTLS/SCTP"===y))o.transceivers[p]={mid:C,kind:l,protocol:y,rejected:!0};else{var _,S,T,E,R,k,P,x,A;!g&&o.transceivers[p]&&o.transceivers[p].rejected&&(o.transceivers[p]=o._createTransceiver(l,!0));var O,L,I=n.parseRtpParameters(c);g||(O=n.getIceParameters(c,f),L=n.getDtlsParameters(c,f),L.role="client"),P=n.parseRtpEncodingParameters(c);var D=n.parseRtcpParameters(c),M=n.matchPrefix(c,"a=end-of-candidates",f).length>0,N=n.matchPrefix(c,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!g&&v&&p>0&&o.transceivers[p]&&(o._disposeIceAndDtlsTransports(p),o.transceivers[p].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[p].iceTransport=o.transceivers[0].iceTransport,o.transceivers[p].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[p].rtpSender&&o.transceivers[p].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[p].rtpReceiver&&o.transceivers[p].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==i.type||g)"answer"!==i.type||g||(_=o.transceivers[p],S=_.iceGatherer,T=_.iceTransport,E=_.dtlsTransport,R=_.rtpReceiver,k=_.sendEncodingParameters,x=_.localCapabilities,o.transceivers[p].recvEncodingParameters=P,o.transceivers[p].remoteCapabilities=I,o.transceivers[p].rtcpParameters=D,N.length&&"new"===T.state&&(!m&&!M||v&&0!==p?N.forEach(function(e){d(_.iceTransport,e)}):T.setRemoteCandidates(N)),v&&0!==p||("new"===T.state&&T.start(S,O,"controlling"),"new"===E.state&&E.start(L)),o._transceive(_,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b),!R||"sendrecv"!==b&&"sendonly"!==b?delete _.rtpReceiver:(A=R.track,w?(s[w.stream]||(s[w.stream]=new e.MediaStream),r(A,s[w.stream]),a.push([A,R,s[w.stream]])):(s.default||(s.default=new e.MediaStream),r(A,s.default),a.push([A,R,s.default]))));else{_=o.transceivers[p]||o._createTransceiver(l),_.mid=C,_.iceGatherer||(_.iceGatherer=o._createIceGatherer(p,v)),N.length&&"new"===_.iceTransport.state&&(!M||v&&0!==p?N.forEach(function(e){d(_.iceTransport,e)}):_.iceTransport.setRemoteCandidates(N)),x=e.RTCRtpReceiver.getCapabilities(l),t<15019&&(x.codecs=x.codecs.filter(function(e){return"rtx"!==e.name})),k=_.sendEncodingParameters||[{ssrc:1001*(2*p+2)}];var j,U=!1;if("sendrecv"===b||"sendonly"===b){if(U=!_.rtpReceiver,R=_.rtpReceiver||new e.RTCRtpReceiver(_.dtlsTransport,l),U)A=R.track,w&&"-"===w.stream||(w?(s[w.stream]||(s[w.stream]=new e.MediaStream,Object.defineProperty(s[w.stream],"id",{get:function(){return w.stream}})),Object.defineProperty(A,"id",{get:function(){return w.track}}),j=s[w.stream]):(s.default||(s.default=new e.MediaStream),j=s.default)),j&&(r(A,j),_.associatedRemoteMediaStreams.push(j)),a.push([A,R,j])}else _.rtpReceiver&&_.rtpReceiver.track&&(_.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===_.rtpReceiver.track.id});t&&u(t,e)}),_.associatedRemoteMediaStreams=[]);_.localCapabilities=x,_.remoteCapabilities=I,_.rtpReceiver=R,_.rtcpParameters=D,_.sendEncodingParameters=k,_.recvEncodingParameters=P,o._transceive(o.transceivers[p],!1,U)}}}),void 0===o._dtlsRole&&(o._dtlsRole="offer"===i.type?"active":"passive"),o._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(s).forEach(function(t){var r=s[t];if(r.getTracks().length){if(-1===o.remoteStreams.indexOf(r)){o.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){o._dispatchEvent("addstream",n)})}a.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&h(o,t,n,[r])})}}),a.forEach(function(e){e[2]||h(o,e[0],e[1],[])}),e.setTimeout(function(){o&&o.transceivers&&o.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},l.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},l.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(p("InvalidStateError","Can not call createOffer after close"));var i=r.transceivers.filter(function(e){return"audio"===e.kind}).length,s=r.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(i=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(s=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}r.transceivers.forEach(function(e){"audio"===e.kind?(i--,i<0&&(e.wantReceive=!1)):"video"===e.kind&&(s--,s<0&&(e.wantReceive=!1))});while(i>0||s>0)i>0&&(r._createTransceiver("audio"),i--),s>0&&(r._createTransceiver("video"),s--);var c=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(i,o){var s=i.track,a=i.kind,c=i.mid||n.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=r._createIceGatherer(o,r.usingBundle));var d=e.RTCRtpSender.getCapabilities(a);t<15019&&(d.codecs=d.codecs.filter(function(e){return"rtx"!==e.name})),d.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),d.headerExtensions.forEach(function(e){var t=i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[];t.forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var p=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];s&&t>=15019&&"video"===a&&!p[0].rtx&&(p[0].rtx={ssrc:p[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,a)),i.localCapabilities=d,i.sendEncodingParameters=p}),"max-compat"!==r._config.bundlePolicy&&(c+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),c+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){c+=o(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),c+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,c+="a="+n.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(c+="a=end-of-candidates\r\n"))});var d=new e.RTCSessionDescription({type:"offer",sdp:c});return Promise.resolve(d)},l.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(p("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(p("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var i=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(i+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var s=n.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,n){if(!(n+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?i+="m=application 0 DTLS/SCTP 5000\r\n":i+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?i+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(i+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(i+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var d=a(e.localCapabilities,e.remoteCapabilities),p=d.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!p&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,i+=o(e,d,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(i+="a=rtcp-rsize\r\n")}});var c=new e.RTCSessionDescription({type:"answer",sdp:i});return Promise.resolve(c)},l.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,o){if(!r._remoteDescription)return o(p("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var s=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<r.transceivers.length;a++)if(r.transceivers[a].mid===e.sdpMid){s=a;break}var c=r.transceivers[s];if(!c)return o(p("OperationError","Can not add ICE candidate"));if(c.rejected)return i();var u=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return i();if(u.component&&1!==u.component)return i();if((0===s||s>0&&c.iceTransport!==r.transceivers[0].iceTransport)&&!d(c.iceTransport,u))return o(p("OperationError","Can not add ICE candidate"));var h=e.candidate.trim();0===h.indexOf("a=")&&(h=h.substr(2)),t=n.getMediaSections(r._remoteDescription.sdp),t[s]+="a="+(u.type?h:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var l=0;l<r.transceivers.length;l++)if(!r.transceivers[l].rejected&&(r.transceivers[l].iceTransport.addRemoteCandidate({}),t=n.getMediaSections(r._remoteDescription.sdp),t[l]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join(""),r.usingBundle))break;i()})},l.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw p("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};var f=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];f.forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){e[r].type=i(e[r]),t.set(r,e[r])}),t})}}});var m=["createOffer","createAnswer"];return m.forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"===typeof e[0]||"function"===typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"===typeof e[0]&&e[0].apply(null,[t])},function(t){"function"===typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),m=["setLocalDescription","setRemoteDescription","addIceCandidate"],m.forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"===typeof e[1]||"function"===typeof e[2]?t.apply(this,arguments).then(function(){"function"===typeof e[1]&&e[1].apply(null)},function(t){"function"===typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"===typeof e[1]?t.apply(this,arguments).then(function(){"function"===typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),l}},f905:function(e,t,r){const n=r("5c7d"),i=r("3396").NexmoClientError;class o{constructor(){this.log=n.getLogger(this.constructor.name),this.ws_config={PROTOCOL_VERSION:"1.0",MAX_BUFFER_LENGTH:50,MAX_RECONNECT_RETRIES:5,RECONNECT_RETRY_TIMEOUT:5e3},this.buffer=[],this.reconnectRetriesCount=0}init(e){this.rtcstatsUri=e.rtcstatsUri,this.reconnect()}reconnect(){if(this.log("TRACE-WS reconnect",this.connection?this.connection.readyState:"no connection"),this.connection&&this.connection.readyState!==WebSocket.CLOSED&&this.connection.close(),delete this.connection,!(this.reconnectRetriesCount>this.ws_config.MAX_RECONNECT_RETRIES)){if(this.reconnectRetriesCount++,!this.rtcstatsUri)throw new i('reporting rtcstatsUri not set use init( {rtcstatsUri:""} )');this.connection=new WebSocket(this.rtcstatsUri,this.ws_config.PROTOCOL_VERSION),this.connection.onerror=(e=>{this.log("TRACE-WS onerror",e)}),this.connection.onopen=(()=>{this.reconnectRetriesCount=0,this.log("TRACE-WS onopen",this.buffer.length);while(this.buffer.length)this.connection.send(JSON.stringify(this.buffer.shift()))}),this.connection.onclose=(e=>{this.log("TRACE-WS onclose",e),setTimeout(()=>{this.reconnect()},this.ws_config.RECONNECT_RETRY_TIMEOUT)})}}trace(){let e=Array.prototype.slice.call(arguments);e.push((new Date).getTime()),this.connection&&this.connection.readyState===WebSocket.OPEN?this.connection.send(JSON.stringify(e)):this.buffer.length<=this.ws_config.MAX_BUFFER_LENGTH&&this.buffer.push(e)}disable(){this.connection.close()}}e.exports=o},f922:function(e,t,r){(function(t){e.exports=o;var r="function"===typeof t.Buffer&&"function"===typeof t.Buffer.isBuffer,n="function"===typeof t.ArrayBuffer,i=function(){return n&&"function"===typeof t.ArrayBuffer.isView?t.ArrayBuffer.isView:function(e){return e.buffer instanceof t.ArrayBuffer}}();function o(e){return r&&t.Buffer.isBuffer(e)||n&&(e instanceof t.ArrayBuffer||i(e))}}).call(this,r("c8ba"))},fa98:function(e,t,r){"use strict";var n=r("955b"),i=n.log;function o(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(function(n){n.endsWith("Id")?o(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(function(t){o(e,e.get(t),r)})}))}function s(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var s=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)}),s.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&o(e,r,i)})}),i}e.exports={shimGetUserMedia:r("bf01"),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!==typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)"RTCRtpTransceiver"in e||n.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||(e.transceiver={receiver:e.receiver}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r._ontrackpoly||(r._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}),t.stream.getTracks().forEach(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})},r.addEventListener("addstream",r._ontrackpoly)),t.apply(r,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"===typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=this,o=r.apply(i,arguments);return o||(o=t(i,e),i._senders.push(o)),o};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;n.apply(t,arguments);var r=t._senders.indexOf(e);-1!==r&&t._senders.splice(r,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;r._senders=r._senders||[],i.apply(r,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"===typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(e,[]);return r.forEach(function(t){t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return s(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),n.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return s(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var t=this;if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var r,n,i,s=arguments[0];return t.getSenders().forEach(function(e){e.track===s&&(r?i=!0:r=e)}),t.getReceivers().forEach(function(e){return e.track===s&&(n?i=!0:n=e),e.track===s}),i||r&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(t,arguments)}}}},shimSourceObject:function(e){var t=e&&e.URL;"object"===typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var r=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});if(r)throw new DOMException("Track already exists.","InvalidAccessError")});var n=t.getSenders();r.apply(this,arguments);var i=t.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){var t=n.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},t.getTracks().forEach(function(e){var t=r.getSenders().find(function(t){return t.track===e});if(t)throw new DOMException("Track already exists.","InvalidAccessError")}),!r._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());r._streams[t.id]=n,r._reverseStreams[n.id]=t,t=n}i.apply(r,[t])};var o=e.RTCPeerConnection.prototype.removeStream;function s(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}function a(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},o.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var o=n.getSenders().find(function(e){return e.track===t});if(o)throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{};var s=n._streams[r.id];if(s)s.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);n._streams[r.id]=a,n._reverseStreams[a.id]=r,n.addStream(a)}return n.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments,n=arguments.length&&"function"===typeof arguments[0];return n?r.apply(e,[function(r){var n=s(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(t){return s(e,t)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=a(e,arguments[0]),c.apply(e,arguments)):c.apply(e,arguments)};var d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this,t=d.get.apply(this);return""===t.type?t:s(e,t)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var r,n=e._pc===t;if(!n)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{},Object.keys(t._streams).forEach(function(n){var i=t._streams[n].getTracks().find(function(t){return e.track===t});i&&(r=t._streams[n])}),r&&(1===r.getTracks().length?t.removeStream(t._reverseStreams[r.id]):r.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(e){var t=n.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection)e.RTCPeerConnection=function(t,r){return i("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,r)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});else{var r=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var s=e.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,i.push(s)):i.push(e.iceServers[o])}e.iceServers=i}return new r(e,t)},e.RTCPeerConnection.prototype=r.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}})}var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,r){var n=this,i=arguments;if(arguments.length>0&&"function"===typeof e)return o.apply(this,arguments);if(0===o.length&&(0===arguments.length||"function"!==typeof arguments[0]))return o.apply(this,[]);var s=function(e){var t={},r=e.result();return r.forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},a=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){i[1](a(s(e)))};return o.apply(this,[c,arguments[0]])}return new Promise(function(e,t){o.apply(n,[function(t){e(a(s(t)))},t])}).then(t,r)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,n=new Promise(function(n,i){r.apply(t,[e[0],n,i])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"===typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,i){r.apply(e,[n,i,t])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var s=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},fixNegotiationNeeded:function(e){n.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){var t=e.target;if("stable"===t.signalingState)return e})},shimGetDisplayMedia:function(e,t){"getDisplayMedia"in e.navigator||("function"===typeof t?navigator.getDisplayMedia=function(e){return t(e).then(function(t){return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:e.video.frameRate||3}},navigator.mediaDevices.getUserMedia(e)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}}}]);
//# sourceMappingURL=chunk-7db3.0cecbf1d.js.map